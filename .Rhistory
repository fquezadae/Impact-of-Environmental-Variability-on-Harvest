rename(specie = Especie) %>%
rename(year = Año) %>%
group_by(specie, year) %>%
summarize(annual_harvest_IND_SERNAPESCA = sum(Desembarque, na.rm = TRUE), .groups = "drop")
annual_harvest_SERNAPESCA_BF <-
read_excel(paste0(dirdata, "AH010T0006857_sobre_desembarque_pelagicos_2012_2024.xlsx"),
sheet = "BF_2017_2024",
range = "A7:R144") %>%
rename(specie = DESCR1TABL) %>%
rename(year = Año) %>%
group_by(specie, year) %>%
summarize(annual_harvest_BF_SERNAPESCA = sum(DESEMBARQUE, na.rm = TRUE), .groups = "drop")
harvest_SERNAPESCA <-
left_join(annual_harvest_SERNAPESCA_ART, annual_harvest_SERNAPESCA_IND, by = c("year", "specie")) %>%
left_join(annual_harvest_SERNAPESCA_BF, by = c("year", "specie")) %>%
mutate(total_harvest_SERNAPESCA = rowSums(across(c(annual_harvest_IND_SERNAPESCA, annual_harvest_ART_SERNAPESCA)), na.rm = TRUE)) %>%
mutate(total_harvest_all_SERNAPESCA = rowSums(across(c(annual_harvest_IND_SERNAPESCA, annual_harvest_BF_SERNAPESCA, annual_harvest_ART_SERNAPESCA)), na.rm = TRUE))
rm(list = c("annual_harvest_SERNAPESCA_ART", "annual_harvest_SERNAPESCA_IND", "annual_harvest_SERNAPESCA_BF"))
library(readxl)
library(dplyr)
harvest_IFOP_jmck_IND <-
read_excel(paste0(dirdata, "4. DESEMBARQUES.xlsx"),
sheet = "INDUSTRIAL (nacional)",
range = "A2:L293") %>%
dplyr::select(c('Años (Fc_Llegada)', 'Meses (Fc_Llegada)', 'Total general')) %>%
mutate(specie = "JUREL") %>%
rename(year = `Años (Fc_Llegada)`) %>%
group_by(specie, year) %>%
summarize(annual_harvest_IND_IFOP  = sum(`Total general`, na.rm = TRUE), .groups = "drop")
harvest_IFOP_sardine_IND <-
read_excel(paste0(dirdata, "4. DESEMBARQUES.xlsx"),
sheet = "INDUSTRIAL (nacional)",
range = "N2:W196") %>%
dplyr::select(c('Años (Fc_Llegada)', 'Meses (Fc_Llegada)', 'Total general')) %>%
mutate(specie = "SARDINA COMUN") %>%
rename(year = `Años (Fc_Llegada)`) %>%
group_by(specie, year) %>%
summarize(annual_harvest_IND_IFOP  = sum(`Total general`, na.rm = TRUE), .groups = "drop")
harvest_IFOP_anchoveta_IND <-
read_excel(paste0(dirdata, "4. DESEMBARQUES.xlsx"),
sheet = "INDUSTRIAL (nacional)",
range = "Y2:AJ273") %>%
dplyr::select(c('Años (Fc_Llegada)', 'Meses (Fc_Llegada)', 'Total general')) %>%
mutate(specie = "ANCHOVETA") %>%
rename(year = `Años (Fc_Llegada)`) %>%
group_by(specie, year) %>%
summarize(annual_harvest_IND_IFOP = sum(`Total general`, na.rm = TRUE), .groups = "drop")
harvest_IFOP_IND <- rbind(harvest_IFOP_jmck_IND, harvest_IFOP_sardine_IND, harvest_IFOP_anchoveta_IND)
rm(list = c("harvest_IFOP_jmck_IND", "harvest_IFOP_sardine_IND", "harvest_IFOP_anchoveta_IND"))
harvest_IFOP_jmck_LANCHAS <-
read_excel(paste0(dirdata, "4. DESEMBARQUES.xlsx"),
sheet = "LANCHAS (CentroSur)",
range = "A2:I143") %>%
dplyr::select(c('Años (Fc_Llegada)', 'Meses (Fc_Llegada)', 'Total general')) %>%
mutate(specie = "JUREL")%>%
rename(year = `Años (Fc_Llegada)`) %>%
group_by(specie, year) %>%
summarize(annual_harvest_LANCHAS_IFOP = sum(`Total general`, na.rm = TRUE), .groups = "drop")
harvest_IFOP_sardine_LANCHAS <-
read_excel(paste0(dirdata, "4. DESEMBARQUES.xlsx"),
sheet = "LANCHAS (CentroSur)",
range = "K2:S170") %>%
dplyr::select(c('Años (Fc_Llegada)', 'Meses (Fc_Llegada)', 'Total general')) %>%
mutate(specie = "SARDINA COMUN")%>%
rename(year = `Años (Fc_Llegada)`) %>%
group_by(specie, year) %>%
summarize(annual_harvest_LANCHAS_IFOP = sum(`Total general`, na.rm = TRUE), .groups = "drop")
harvest_IFOP_anchoveta_LANCHAS <-
read_excel(paste0(dirdata, "4. DESEMBARQUES.xlsx"),
sheet = "LANCHAS (CentroSur)",
range = "U2:AC169") %>%
dplyr::select(c('Años (Fc_Llegada)', 'Meses (Fc_Llegada)', 'Total general')) %>%
mutate(specie = "ANCHOVETA")%>%
rename(year = `Años (Fc_Llegada)`) %>%
group_by(specie, year) %>%
summarize(annual_harvest_LANCHAS_IFOP = sum(`Total general`, na.rm = TRUE), .groups = "drop")
harvest_IFOP_LANCHAS <- rbind(harvest_IFOP_jmck_LANCHAS, harvest_IFOP_sardine_LANCHAS, harvest_IFOP_anchoveta_LANCHAS)
rm(list = c("harvest_IFOP_jmck_LANCHAS", "harvest_IFOP_sardine_LANCHAS", "harvest_IFOP_anchoveta_LANCHAS"))
harvest_IFOP_jmck_BOTES <-
read_excel(paste0(dirdata, "4. DESEMBARQUES.xlsx"),
sheet = "BOTES (CentroSur)",
range = "A2:I146") %>%
dplyr::select(c('Años (Fc_Llegada)', 'Meses (Fc_Llegada)', 'Total general')) %>%
mutate(specie = "JUREL") %>%
rename(year = `Años (Fc_Llegada)`) %>%
group_by(specie, year) %>%
summarize(annual_harvest_BOTES_IFOP = sum(`Total general`, na.rm = TRUE), .groups = "drop")
harvest_IFOP_sardine_BOTES <-
read_excel(paste0(dirdata, "4. DESEMBARQUES.xlsx"),
sheet = "BOTES (CentroSur)",
range = "K2:S163") %>%
dplyr::select(c('Años (Fc_Llegada)', 'Meses (Fc_Llegada)', 'Total general')) %>%
mutate(specie = "SARDINA COMUN") %>%
rename(year = `Años (Fc_Llegada)`) %>%
group_by(specie, year) %>%
summarize(annual_harvest_BOTES_IFOP = sum(`Total general`, na.rm = TRUE), .groups = "drop")
harvest_IFOP_anchoveta_BOTES <-
read_excel(paste0(dirdata, "4. DESEMBARQUES.xlsx"),
sheet = "BOTES (CentroSur)",
range = "U2:AD109") %>%
dplyr::select(c('Años (Fc_Llegada)', 'Meses (Fc_Llegada)', 'Total general')) %>%
mutate(specie = "ANCHOVETA") %>%
rename(year = `Años (Fc_Llegada)`) %>%
group_by(specie, year) %>%
summarize(annual_harvest_BOTES_IFOP = sum(`Total general`, na.rm = TRUE), .groups = "drop")
harvest_IFOP_BOTES <- rbind(harvest_IFOP_jmck_BOTES, harvest_IFOP_sardine_BOTES, harvest_IFOP_anchoveta_BOTES)
rm(list = c("harvest_IFOP_jmck_BOTES", "harvest_IFOP_sardine_BOTES", "harvest_IFOP_anchoveta_BOTES"))
harvest_IFOP <-
left_join(harvest_IFOP_LANCHAS, harvest_IFOP_BOTES, by = c("year", "specie")) %>%
left_join(harvest_IFOP_IND, by = c("year", "specie")) %>%
mutate(total_harvest_IFOP = rowSums(across(c(annual_harvest_IND_IFOP, annual_harvest_LANCHAS_IFOP, , annual_harvest_BOTES_IFOP)), na.rm = TRUE))
rm(list = c("harvest_IFOP_IND", "harvest_IFOP_BOTES", "harvest_IFOP_LANCHAS"))
library(readxl)
library(dplyr)
harvest <-
left_join(harvest_IFOP, harvest_SERNAPESCA, by = c("year", "specie"))
rm(list = c("harvest_IFOP", "harvest_SERNAPESCA"))
library(ggplot2)
library(dplyr)
library(tidyr)
harvest_long <- harvest %>%
pivot_longer(cols = c("annual_harvest_LANCHAS_IFOP",
"annual_harvest_BOTES_IFOP",
"annual_harvest_IND_IFOP",
"total_harvest_IFOP",
"annual_harvest_ART_SERNAPESCA",
"annual_harvest_IND_SERNAPESCA",
"annual_harvest_BF_SERNAPESCA",
"total_harvest_SERNAPESCA",
"total_harvest_all_SERNAPESCA"),
names_to = "source",
values_to = "harvest") %>%
mutate(source = recode(source,
"annual_harvest_LANCHAS_IFOP" = "Lanchas Artesanal IFOP",
"annual_harvest_BOTES_IFOP" = "Botes Artesanal IFOP",
"annual_harvest_IND_IFOP" = "Industrial IFOP",
"total_harvest_IFOP" = "Total IFOP",
"annual_harvest_ART_SERNAPESCA" = "Artesanal SERNAPESCA",
"annual_harvest_IND_SERNAPESCA" = "Industrial SERNAPESCA",
"annual_harvest_BF_SERNAPESCA" = "Barcos Factoría SERNAPESCA",
"total_harvest_SERNAPESCA" = "Total SERNAPESCA (no BF)",
"total_harvest_all_SERNAPESCA" = "Total SERNAPESCA")) %>%
filter(source %in% c("Total IFOP", "Total SERNAPESCA"))
# Gráfico
ggplot(harvest_long, aes(x = year, y = harvest, color = source)) +
geom_line(size = 1) +
facet_wrap(~specie, scales = "free_y") +
labs(x = "Año",
y = "Annual landings (tons)",
color = "Source") +
theme_minimal() +
theme(legend.position = "bottom")
rm(harvest_long)
library(ggplot2)
library(tidyr)
library(scales)
library(viridis)
biomass_long <- biomass %>%
pivot_longer(cols = c(sardine_biomass_max, sardine_biomass_sum, sardine_biomass_mean,
anchoveta_biomass_max, anchoveta_biomass_sum, anchoveta_biomass_mean,
jackmackerel_biomass),
names_to = "species",
values_to = "biomass") %>%
filter(!is.na(biomass)) %>%
arrange(species, year)
biomass_long$biomass <- as.numeric(biomass_long$biomass)
biomass_long$year <- as.numeric(biomass_long$year)
biomass_long$species <- recode(biomass_long$species,
sardine_biomass_max = "Sardine",
sardine_biomass_sum = "Sardine (sum)",
sardine_biomass_mean = "Sardine (mean)",
anchoveta_biomass_max = "Anchoveta",
anchoveta_biomass_sum = "Anchoveta (sum)",
anchoveta_biomass_mean = "Anchoveta (mean)",
jackmackerel_biomass = "Jack Mackerel")
biomass <- biomass_long %>% filter(species %in% c("Sardine", "Anchoveta", "Jack Mackerel"))
# Plot
ggplot(biomass, aes(x = year, y = biomass, color = species, group = species)) +
geom_smooth(se = TRUE, method = "loess", span = 0.4, linetype = "solid") +
scale_y_continuous(labels = comma) +  # Or use scale_y_log10(labels = comma) to compress
labs(x = "Year",
y = "Biomass (tons)",
color = "Species") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5),
axis.text.y = element_text(angle = 0, hjust = 1),
legend.position = "right"
) +
scale_color_viridis_d(option = "D")
rm(list = c("biomass_long"))
library(tidyverse)
harvest <- harvest %>%
select(c(specie, year, total_harvest_all_SERNAPESCA)) %>%
mutate(specie = recode(specie,
"SARDINA COMUN" = "Sardine",
"JUREL" = "Jack Mackerel",
"ANCHOVETA" = "Anchoveta"
)) %>%
rename(harvest = total_harvest_all_SERNAPESCA) %>%
rename(species = specie)
biomass_harvest <- full_join(biomass, harvest,
by = c("species" = "species", "year" = "year")) %>%
arrange(species, year)
View(biomass_harvest)
View(biomass_harvest)
head(biomass_harvest)
biomass_harvest_long <- biomass_harvest %>%
pivot_longer(cols = c(biomass, harvest),
names_to = "variable",
values_to = "value")
View(biomass_harvest_long)
library(tidyverse)
harvest <- harvest %>%
select(c(specie, year, total_harvest_all_SERNAPESCA)) %>%
mutate(specie = recode(specie,
"SARDINA COMUN" = "Sardine",
"JUREL" = "Jack Mackerel",
"ANCHOVETA" = "Anchoveta"
)) %>%
rename(harvest = total_harvest_all_SERNAPESCA) %>%
rename(species = specie)
rm(list = ls())
gc()
library(readxl)
library(dplyr)
# Definir directorios según usuario
usuario <- Sys.info()[["user"]]
# computador <- Sys.info()[["nodename"]]  # Alternativamente puedes usar esto
if (usuario == "fequezad") {
dirdata <- "C:/Users/fequezad/OneDrive - Universidad de Concepción/FONDECYT Iniciacion/Data/"
} else if (usuario == "FACEA") {
dirdata <- "C:/Users/FACEA/OneDrive - Universidad de Concepción/FONDECYT Iniciacion/Data/"
} else {
stop("Usuario no reconocido. Defina el directorio correspondiente.")
}
rm(usuario)
library(dplyr)
#Anchovy and sardine biomass
anch_sard_biomass <- read_excel(paste0(dirdata, "3. ESTIMACIONES CRUCERO ACUSTICO.xlsx"), sheet = "SARDINA-ANCHOVETA")
anch_sard_biomass <- anch_sard_biomass[, c(1, 3, 4)]
anch_sard_biomass <- anch_sard_biomass[-1, ]
colnames(anch_sard_biomass) <- c("year", "sardine_biomass", "anchoveta_biomass")
anch_sard_biomass <- anch_sard_biomass %>%
mutate(across(ends_with("biomass"), ~as.numeric(.))) %>% group_by(year) %>%
summarise(
sardine_biomass_max = max(sardine_biomass, na.rm = TRUE),
sardine_biomass_sum = sum(sardine_biomass, na.rm = TRUE),
sardine_biomass_mean = mean(sardine_biomass, na.rm = TRUE),
anchoveta_biomass_max = max(anchoveta_biomass, na.rm = TRUE),
anchoveta_biomass_sum = sum(anchoveta_biomass, na.rm = TRUE),
anchoveta_biomass_mean = mean(anchoveta_biomass, na.rm = TRUE)
)
anch_sard_biomass$year <- as.numeric(anch_sard_biomass$year)
# Jack Mackerel Biomass
jackmackerel_biomass <- read_excel(paste0(dirdata, "3. ESTIMACIONES CRUCERO ACUSTICO.xlsx"), sheet = "JUREL")
jackmackerel_biomass  <- jackmackerel_biomass[, c(1, 3)]
jackmackerel_biomass  <- jackmackerel_biomass[-1, ]
colnames(jackmackerel_biomass) <- c("year", "jackmackerel_biomass")
jackmackerel_biomass <- jackmackerel_biomass %>%
mutate(across(ends_with("biomass"), ~as.numeric(.))) %>%
mutate(jackmackerel_biomass = ifelse(jackmackerel_biomass == 0, NA, jackmackerel_biomass))
jackmackerel_biomass$year <- as.numeric(jackmackerel_biomass$year)
# All species biomass
biomass <- full_join(anch_sard_biomass, jackmackerel_biomass, by = "year")
rm(list = c("anch_sard_biomass", "jackmackerel_biomass"))
library(readxl)
library(dplyr)
annual_harvest_SERNAPESCA_ART <-
read_excel(paste0(dirdata, "AH010T0006857_sobre_desembarque_pelagicos_2012_2024.xlsx"),
sheet = "ART_2012_2024",
range = "A6:S36337") %>%
rename(specie = Especie) %>%
rename(year = Año) %>%
group_by(specie, year) %>%
summarize(annual_harvest_ART_SERNAPESCA = sum(SumaDeDesembarque, na.rm = TRUE), .groups = "drop")
annual_harvest_SERNAPESCA_IND <-
read_excel(paste0(dirdata, "AH010T0006857_sobre_desembarque_pelagicos_2012_2024.xlsx"),
sheet = "IND_2012_2024",
range = "A6:R3349") %>%
rename(specie = Especie) %>%
rename(year = Año) %>%
group_by(specie, year) %>%
summarize(annual_harvest_IND_SERNAPESCA = sum(Desembarque, na.rm = TRUE), .groups = "drop")
annual_harvest_SERNAPESCA_BF <-
read_excel(paste0(dirdata, "AH010T0006857_sobre_desembarque_pelagicos_2012_2024.xlsx"),
sheet = "BF_2017_2024",
range = "A7:R144") %>%
rename(specie = DESCR1TABL) %>%
rename(year = Año) %>%
group_by(specie, year) %>%
summarize(annual_harvest_BF_SERNAPESCA = sum(DESEMBARQUE, na.rm = TRUE), .groups = "drop")
harvest_SERNAPESCA <-
left_join(annual_harvest_SERNAPESCA_ART, annual_harvest_SERNAPESCA_IND, by = c("year", "specie")) %>%
left_join(annual_harvest_SERNAPESCA_BF, by = c("year", "specie")) %>%
mutate(total_harvest_SERNAPESCA = rowSums(across(c(annual_harvest_IND_SERNAPESCA, annual_harvest_ART_SERNAPESCA)), na.rm = TRUE)) %>%
mutate(total_harvest_all_SERNAPESCA = rowSums(across(c(annual_harvest_IND_SERNAPESCA, annual_harvest_BF_SERNAPESCA, annual_harvest_ART_SERNAPESCA)), na.rm = TRUE))
rm(list = c("annual_harvest_SERNAPESCA_ART", "annual_harvest_SERNAPESCA_IND", "annual_harvest_SERNAPESCA_BF"))
library(readxl)
library(dplyr)
harvest_IFOP_jmck_IND <-
read_excel(paste0(dirdata, "4. DESEMBARQUES.xlsx"),
sheet = "INDUSTRIAL (nacional)",
range = "A2:L293") %>%
dplyr::select(c('Años (Fc_Llegada)', 'Meses (Fc_Llegada)', 'Total general')) %>%
mutate(specie = "JUREL") %>%
rename(year = `Años (Fc_Llegada)`) %>%
group_by(specie, year) %>%
summarize(annual_harvest_IND_IFOP  = sum(`Total general`, na.rm = TRUE), .groups = "drop")
harvest_IFOP_sardine_IND <-
read_excel(paste0(dirdata, "4. DESEMBARQUES.xlsx"),
sheet = "INDUSTRIAL (nacional)",
range = "N2:W196") %>%
dplyr::select(c('Años (Fc_Llegada)', 'Meses (Fc_Llegada)', 'Total general')) %>%
mutate(specie = "SARDINA COMUN") %>%
rename(year = `Años (Fc_Llegada)`) %>%
group_by(specie, year) %>%
summarize(annual_harvest_IND_IFOP  = sum(`Total general`, na.rm = TRUE), .groups = "drop")
harvest_IFOP_anchoveta_IND <-
read_excel(paste0(dirdata, "4. DESEMBARQUES.xlsx"),
sheet = "INDUSTRIAL (nacional)",
range = "Y2:AJ273") %>%
dplyr::select(c('Años (Fc_Llegada)', 'Meses (Fc_Llegada)', 'Total general')) %>%
mutate(specie = "ANCHOVETA") %>%
rename(year = `Años (Fc_Llegada)`) %>%
group_by(specie, year) %>%
summarize(annual_harvest_IND_IFOP = sum(`Total general`, na.rm = TRUE), .groups = "drop")
harvest_IFOP_IND <- rbind(harvest_IFOP_jmck_IND, harvest_IFOP_sardine_IND, harvest_IFOP_anchoveta_IND)
rm(list = c("harvest_IFOP_jmck_IND", "harvest_IFOP_sardine_IND", "harvest_IFOP_anchoveta_IND"))
harvest_IFOP_jmck_LANCHAS <-
read_excel(paste0(dirdata, "4. DESEMBARQUES.xlsx"),
sheet = "LANCHAS (CentroSur)",
range = "A2:I143") %>%
dplyr::select(c('Años (Fc_Llegada)', 'Meses (Fc_Llegada)', 'Total general')) %>%
mutate(specie = "JUREL")%>%
rename(year = `Años (Fc_Llegada)`) %>%
group_by(specie, year) %>%
summarize(annual_harvest_LANCHAS_IFOP = sum(`Total general`, na.rm = TRUE), .groups = "drop")
harvest_IFOP_sardine_LANCHAS <-
read_excel(paste0(dirdata, "4. DESEMBARQUES.xlsx"),
sheet = "LANCHAS (CentroSur)",
range = "K2:S170") %>%
dplyr::select(c('Años (Fc_Llegada)', 'Meses (Fc_Llegada)', 'Total general')) %>%
mutate(specie = "SARDINA COMUN")%>%
rename(year = `Años (Fc_Llegada)`) %>%
group_by(specie, year) %>%
summarize(annual_harvest_LANCHAS_IFOP = sum(`Total general`, na.rm = TRUE), .groups = "drop")
harvest_IFOP_anchoveta_LANCHAS <-
read_excel(paste0(dirdata, "4. DESEMBARQUES.xlsx"),
sheet = "LANCHAS (CentroSur)",
range = "U2:AC169") %>%
dplyr::select(c('Años (Fc_Llegada)', 'Meses (Fc_Llegada)', 'Total general')) %>%
mutate(specie = "ANCHOVETA")%>%
rename(year = `Años (Fc_Llegada)`) %>%
group_by(specie, year) %>%
summarize(annual_harvest_LANCHAS_IFOP = sum(`Total general`, na.rm = TRUE), .groups = "drop")
harvest_IFOP_LANCHAS <- rbind(harvest_IFOP_jmck_LANCHAS, harvest_IFOP_sardine_LANCHAS, harvest_IFOP_anchoveta_LANCHAS)
rm(list = c("harvest_IFOP_jmck_LANCHAS", "harvest_IFOP_sardine_LANCHAS", "harvest_IFOP_anchoveta_LANCHAS"))
harvest_IFOP_jmck_BOTES <-
read_excel(paste0(dirdata, "4. DESEMBARQUES.xlsx"),
sheet = "BOTES (CentroSur)",
range = "A2:I146") %>%
dplyr::select(c('Años (Fc_Llegada)', 'Meses (Fc_Llegada)', 'Total general')) %>%
mutate(specie = "JUREL") %>%
rename(year = `Años (Fc_Llegada)`) %>%
group_by(specie, year) %>%
summarize(annual_harvest_BOTES_IFOP = sum(`Total general`, na.rm = TRUE), .groups = "drop")
harvest_IFOP_sardine_BOTES <-
read_excel(paste0(dirdata, "4. DESEMBARQUES.xlsx"),
sheet = "BOTES (CentroSur)",
range = "K2:S163") %>%
dplyr::select(c('Años (Fc_Llegada)', 'Meses (Fc_Llegada)', 'Total general')) %>%
mutate(specie = "SARDINA COMUN") %>%
rename(year = `Años (Fc_Llegada)`) %>%
group_by(specie, year) %>%
summarize(annual_harvest_BOTES_IFOP = sum(`Total general`, na.rm = TRUE), .groups = "drop")
harvest_IFOP_anchoveta_BOTES <-
read_excel(paste0(dirdata, "4. DESEMBARQUES.xlsx"),
sheet = "BOTES (CentroSur)",
range = "U2:AD109") %>%
dplyr::select(c('Años (Fc_Llegada)', 'Meses (Fc_Llegada)', 'Total general')) %>%
mutate(specie = "ANCHOVETA") %>%
rename(year = `Años (Fc_Llegada)`) %>%
group_by(specie, year) %>%
summarize(annual_harvest_BOTES_IFOP = sum(`Total general`, na.rm = TRUE), .groups = "drop")
harvest_IFOP_BOTES <- rbind(harvest_IFOP_jmck_BOTES, harvest_IFOP_sardine_BOTES, harvest_IFOP_anchoveta_BOTES)
rm(list = c("harvest_IFOP_jmck_BOTES", "harvest_IFOP_sardine_BOTES", "harvest_IFOP_anchoveta_BOTES"))
harvest_IFOP <-
left_join(harvest_IFOP_LANCHAS, harvest_IFOP_BOTES, by = c("year", "specie")) %>%
left_join(harvest_IFOP_IND, by = c("year", "specie")) %>%
mutate(total_harvest_IFOP = rowSums(across(c(annual_harvest_IND_IFOP, annual_harvest_LANCHAS_IFOP, , annual_harvest_BOTES_IFOP)), na.rm = TRUE))
rm(list = c("harvest_IFOP_IND", "harvest_IFOP_BOTES", "harvest_IFOP_LANCHAS"))
library(readxl)
library(dplyr)
harvest <-
left_join(harvest_IFOP, harvest_SERNAPESCA, by = c("year", "specie"))
rm(list = c("harvest_IFOP", "harvest_SERNAPESCA"))
library(ggplot2)
library(dplyr)
library(tidyr)
harvest_long <- harvest %>%
pivot_longer(cols = c("annual_harvest_LANCHAS_IFOP",
"annual_harvest_BOTES_IFOP",
"annual_harvest_IND_IFOP",
"total_harvest_IFOP",
"annual_harvest_ART_SERNAPESCA",
"annual_harvest_IND_SERNAPESCA",
"annual_harvest_BF_SERNAPESCA",
"total_harvest_SERNAPESCA",
"total_harvest_all_SERNAPESCA"),
names_to = "source",
values_to = "harvest") %>%
mutate(source = recode(source,
"annual_harvest_LANCHAS_IFOP" = "Lanchas Artesanal IFOP",
"annual_harvest_BOTES_IFOP" = "Botes Artesanal IFOP",
"annual_harvest_IND_IFOP" = "Industrial IFOP",
"total_harvest_IFOP" = "Total IFOP",
"annual_harvest_ART_SERNAPESCA" = "Artesanal SERNAPESCA",
"annual_harvest_IND_SERNAPESCA" = "Industrial SERNAPESCA",
"annual_harvest_BF_SERNAPESCA" = "Barcos Factoría SERNAPESCA",
"total_harvest_SERNAPESCA" = "Total SERNAPESCA (no BF)",
"total_harvest_all_SERNAPESCA" = "Total SERNAPESCA")) %>%
filter(source %in% c("Total IFOP", "Total SERNAPESCA"))
# Gráfico
ggplot(harvest_long, aes(x = year, y = harvest, color = source)) +
geom_line(size = 1) +
facet_wrap(~specie, scales = "free_y") +
labs(x = "Año",
y = "Annual landings (tons)",
color = "Source") +
theme_minimal() +
theme(legend.position = "bottom")
rm(harvest_long)
library(ggplot2)
library(tidyr)
library(scales)
library(viridis)
biomass_long <- biomass %>%
pivot_longer(cols = c(sardine_biomass_max, sardine_biomass_sum, sardine_biomass_mean,
anchoveta_biomass_max, anchoveta_biomass_sum, anchoveta_biomass_mean,
jackmackerel_biomass),
names_to = "species",
values_to = "biomass") %>%
filter(!is.na(biomass)) %>%
arrange(species, year)
biomass_long$biomass <- as.numeric(biomass_long$biomass)
biomass_long$year <- as.numeric(biomass_long$year)
biomass_long$species <- recode(biomass_long$species,
sardine_biomass_max = "Sardine",
sardine_biomass_sum = "Sardine (sum)",
sardine_biomass_mean = "Sardine (mean)",
anchoveta_biomass_max = "Anchoveta",
anchoveta_biomass_sum = "Anchoveta (sum)",
anchoveta_biomass_mean = "Anchoveta (mean)",
jackmackerel_biomass = "Jack Mackerel")
biomass <- biomass_long %>% filter(species %in% c("Sardine", "Anchoveta", "Jack Mackerel"))
# Plot
ggplot(biomass, aes(x = year, y = biomass, color = species, group = species)) +
geom_smooth(se = TRUE, method = "loess", span = 0.4, linetype = "solid") +
scale_y_continuous(labels = comma) +  # Or use scale_y_log10(labels = comma) to compress
labs(x = "Year",
y = "Biomass (tons)",
color = "Species") +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5),
axis.text.y = element_text(angle = 0, hjust = 1),
legend.position = "right"
) +
scale_color_viridis_d(option = "D")
rm(list = c("biomass_long"))
library(tidyverse)
harvest <- harvest %>%
select(c(specie, year, total_harvest_all_SERNAPESCA)) %>%
mutate(specie = recode(specie,
"SARDINA COMUN" = "Sardine",
"JUREL" = "Jack Mackerel",
"ANCHOVETA" = "Anchoveta"
)) %>%
rename(harvest = total_harvest_all_SERNAPESCA) %>%
rename(species = specie)
biomass_harvest <- full_join(biomass, harvest, by = c("species" = "species", "year" = "year")) %>% arrange(species, year)
biomass_harvest_long <- biomass_harvest %>%
pivot_longer(cols = c(biomass, harvest),
names_to = "variable",
values_to = "value")
ggplot(df_long, aes(x = year, y = value, color = variable)) +
geom_line(size = 1, na.rm = TRUE) +  # ignores NAs for smooth lines
geom_point(size = 2, na.rm = TRUE) + # adds points, optional
facet_wrap(~species, scales = "free_y") +  # 1 panel per species, adjust scales as needed
labs(x = "Year", y = "Value (tons)", color = "Variable") +
scale_color_manual(values = c("biomass" = "darkgreen", "harvest" = "steelblue")) +
theme_minimal() +
theme(legend.position = "top")
library(tidyverse)
harvest <- harvest %>%
select(c(specie, year, total_harvest_all_SERNAPESCA)) %>%
mutate(specie = recode(specie,
"SARDINA COMUN" = "Sardine",
"JUREL" = "Jack Mackerel",
"ANCHOVETA" = "Anchoveta"
)) %>%
rename(harvest = total_harvest_all_SERNAPESCA) %>%
rename(species = specie)
ggplot(biomass_harvest_long, aes(x = year, y = value, color = variable)) +
geom_line(size = 1, na.rm = TRUE) +  # ignores NAs for smooth lines
geom_point(size = 2, na.rm = TRUE) + # adds points, optional
facet_wrap(~species, scales = "free_y") +  # 1 panel per species, adjust scales as needed
labs(x = "Year", y = "Value (tons)", color = "Variable") +
scale_color_manual(values = c("biomass" = "darkgreen", "harvest" = "steelblue")) +
theme_minimal() +
theme(legend.position = "top")
