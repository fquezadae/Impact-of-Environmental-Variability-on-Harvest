year = Año,
region = `Región`,
vessel_id = `CD_MATRICU`) %>%
mutate(zone = case_when(
region %in% c(1,2,3,4,15) ~ "Norte",
region %in% c(5,6,7,8,9,10,14,16) ~ "Centro-Sur",
region %in% c(11,12) ~ "Extremo Sur",
TRUE ~ "No Especifica")) %>%
filter(zone == "Centro-Sur")
rm(list = ls())
gc()
library(readxl)
library(dplyr)
# Definir directorios según usuario
usuario <- Sys.info()[["user"]]
# computador <- Sys.info()[["nodename"]]  # Alternativamente puedes usar esto
if (usuario == "felip") {
dirdata <- "C:/Users/felip/OneDrive - Universidad de Concepción/FONDECYT Iniciacion/Data/"
} else if (usuario == "FACEA") {
dirdata <- "C:/Users/FACEA/OneDrive - Universidad de Concepción/FONDECYT Iniciacion/Data/"
} else {
stop("Usuario no reconocido. Defina el directorio correspondiente.")
}
rm(usuario)
library(dplyr)
library(stringr)
#Anchovy and sardine biomass
anch_sard_biomass <- read_excel(paste0(dirdata, "IFOP/3. ESTIMACIONES CRUCERO ACUSTICO.xlsx"), sheet = "SARDINA-ANCHOVETA")
anch_sard_biomass <- anch_sard_biomass[, c(1, 2, 3, 4)]
anch_sard_biomass <- anch_sard_biomass[-1, ]
colnames(anch_sard_biomass) <- c("year", "cruise", "sardine_biomass", "anchoveta_biomass")
anch_sard_biomass <- anch_sard_biomass %>%
filter(str_detect(cruise, "Reclas")) %>%  ## Summer survey!
dplyr::select(-c(cruise)) %>%
mutate(across(ends_with("biomass"), ~as.numeric(.)))
anch_sard_biomass$year <- as.numeric(anch_sard_biomass$year)
#Jurel biomass
jurel_biomass <- read_excel(paste0(dirdata, "IFOP/3. ESTIMACIONES CRUCERO ACUSTICO.xlsx"), sheet = "JUREL")
jurel_biomass <- jurel_biomass[, c(1, 3)]
jurel_biomass <- jurel_biomass[-1, ]
colnames(jurel_biomass) <- c("year", "jurel_biomass")
jurel_biomass <- jurel_biomass %>%
mutate(across(ends_with("biomass"), ~as.numeric(.))) %>%
mutate(jurel_biomass = ifelse(jurel_biomass == 0, NA, jurel_biomass))
jurel_biomass$year <- as.numeric(jurel_biomass$year)
# Merge databse
biomass <- full_join(anch_sard_biomass, jurel_biomass, by = c("year")) %>% arrange(year)
rm(list = c("anch_sard_biomass", "jurel_biomass"))
rm(list = ls())
gc()
library(readxl)
library(dplyr)
# Definir directorios según usuario
usuario <- Sys.info()[["user"]]
# computador <- Sys.info()[["nodename"]]  # Alternativamente puedes usar esto
if (usuario == "felip") {
dirdata <- "C:/Users/felip/OneDrive - Universidad de Concepción/FONDECYT Iniciacion/Data/"
} else if (usuario == "FACEA") {
dirdata <- "C:/Users/FACEA/OneDrive - Universidad de Concepción/FONDECYT Iniciacion/Data/"
} else {
stop("Usuario no reconocido. Defina el directorio correspondiente.")
}
rm(usuario)
library(dplyr)
library(stringr)
#Anchovy and sardine biomass
anch_sard_biomass <- read_excel(paste0(dirdata, "IFOP/3. ESTIMACIONES CRUCERO ACUSTICO.xlsx"), sheet = "SARDINA-ANCHOVETA")
anch_sard_biomass <- anch_sard_biomass[, c(1, 2, 3, 4)]
anch_sard_biomass <- anch_sard_biomass[-1, ]
colnames(anch_sard_biomass) <- c("year", "cruise", "sardine_biomass", "anchoveta_biomass")
anch_sard_biomass <- anch_sard_biomass %>%
filter(str_detect(cruise, "Reclas")) %>%  ## Summer survey!
dplyr::select(-c(cruise)) %>%
mutate(across(ends_with("biomass"), ~as.numeric(.)))
anch_sard_biomass$year <- as.numeric(anch_sard_biomass$year)
#Jurel biomass
jurel_biomass <- read_excel(paste0(dirdata, "IFOP/3. ESTIMACIONES CRUCERO ACUSTICO.xlsx"), sheet = "JUREL")
jurel_biomass <- jurel_biomass[, c(1, 3)]
jurel_biomass <- jurel_biomass[-1, ]
colnames(jurel_biomass) <- c("year", "jurel_biomass")
jurel_biomass <- jurel_biomass %>%
mutate(across(ends_with("biomass"), ~as.numeric(.))) %>%
mutate(jurel_biomass = ifelse(jurel_biomass == 0, NA, jurel_biomass))
jurel_biomass$year <- as.numeric(jurel_biomass$year)
# Merge databse
biomass <- full_join(anch_sard_biomass, jurel_biomass, by = c("year")) %>% arrange(year)
rm(list = c("anch_sard_biomass", "jurel_biomass"))
library(readxl)
library(dplyr)
library(tidyr)
library(purrr)
ind_harvest_SERNAPESCA_ART <-
read_excel(paste0(dirdata, "SERNAPESCA/AH010T0006857_sobre_desembarque_pelagicos_2012_2024.xlsx"),
sheet = "ART_2012_2024",
range = "A6:S36337") %>%
rename(specie = Especie,
year = Año,
region = `Región de Operación`,
vessel_id = `RPA Embarcación`) %>%
mutate(zone = case_when(
region %in% c(1,2,3,4,15) ~ "Norte",
region %in% c(5,6,7,8,9,10,14,16) ~ "Centro-Sur",
region %in% c(11,12) ~ "Extremo Sur",
TRUE ~ "No Especifica"
)) %>%
filter(zone == "Centro-Sur")
vessel_species_year_ART <- ind_harvest_SERNAPESCA_ART %>%
select(vessel_id, year, specie, SumaDeDesembarque) %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE)) %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch, na.rm = TRUE)) %>%
ungroup() %>%
select(-c(total_catch)) %>%
complete(vessel_id, year, specie, fill = list(species_share = 0)) %>%
group_by(vessel_id, year) %>%
mutate(species_share_check = sum(species_share, na.rm = TRUE)) %>%
filter(species_share_check > 0) %>%
dplyr::select(-c(species_share_check)) %>%
group_by(vessel_id, specie) %>%
summarize(species_share = mean(species_share, na.rm = TRUE)) %>%
pivot_wider(
names_from = specie,
values_from = species_share,
values_fill = 0) %>%
rename(
Anchoveta = `ANCHOVETA`,
Sardine = `SARDINA COMUN`,
AustralSardine = `SARDINA AUSTRAL`,
SpanishSardine = `SARDINA ESPAÑOLA`,
JackMackerel = `JUREL`
)
get_strategy <- function(sardine, jackmackerel, anchoveta, australsardine, spanishsardine) {
species <- c()
if (sardine > 0.15) species <- c(species, "Sardine")
if (jackmackerel > 0.15) species <- c(species, "JackMackerel")
if (anchoveta > 0.15) species <- c(species, "Anchoveta")
if (australsardine > 0.15) species <- c(species, "AustralSardine")
if (spanishsardine> 0.15) species <- c(species, "SpanishSardine")
n <- length(species)
if (n == 0) return("None or negligible")
if (n == 1) return(paste("Only", species[1]))
if (n == 2) return(paste(species[1], "and", species[2]))
if (n == 3) return(paste(species[1], ",", species[2], "and", species[3]))
if (n == 4) return(paste(species[1], ",", species[2], ",", species[3], "and", species[4]))
return("All species")
}
vessel_strategies_yearly_ART <- vessel_species_year_ART %>%
mutate(strategy = pmap_chr(
list(Sardine, JackMackerel, Anchoveta, AustralSardine, SpanishSardine),
get_strategy
))
strategy_percent_ART <- vessel_strategies_yearly_ART %>%
group_by(strategy) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(percent = round(100 * n / sum(n), 1)) %>%
arrange(desc(percent))  %>%
mutate(sector = "SmallScale")
#####################################################
ind_harvest_SERNAPESCA_IND <-
read_excel(paste0(dirdata, "SERNAPESCA/AH010T0006857_sobre_desembarque_pelagicos_2012_2024.xlsx"),
sheet = "IND_2012_2024",
range = "A6:R3349") %>%
rename(specie = Especie,
year = Año,
region = `Región`,
vessel_id = `CD_MATRICU`) %>%
mutate(zone = case_when(
region %in% c(1,2,3,4,15) ~ "Norte",
region %in% c(5,6,7,8,9,10,14,16) ~ "Centro-Sur",
region %in% c(11,12) ~ "Extremo Sur",
TRUE ~ "No Especifica")) %>%
filter(zone == "Centro-Sur")
vessel_species_year_IND <- ind_harvest_SERNAPESCA_IND %>%
select(vessel_id, year, specie, Desembarque) %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(Desembarque, na.rm = TRUE)) %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch, na.rm = TRUE)) %>%
ungroup() %>%
select(-c(total_catch)) %>%
complete(vessel_id, year, specie, fill = list(species_share = 0)) %>%
group_by(vessel_id, year) %>%
mutate(species_share_check = sum(species_share, na.rm = TRUE)) %>%
filter(species_share_check > 0) %>%
dplyr::select(-c(species_share_check)) %>%
group_by(vessel_id, specie) %>% ### OJO ACA!
summarize(species_share = mean(species_share, na.rm = TRUE)) %>%
pivot_wider(
names_from = specie,
values_from = species_share,
values_fill = 0
) %>%
rename(
Anchoveta = `ANCHOVETA`,
Sardine = `SARDINA COMUN`,
SpanishSardine = `SARDINA ESPAÑOLA`,
JackMackerel = `JUREL`
)
get_strategy <- function(sardine, jackmackerel, anchoveta, spanishsardine) {
species <- c()
if (sardine > 0.15) species <- c(species, "Sardine")
if (jackmackerel > 0.15) species <- c(species, "JackMackerel")
if (anchoveta > 0.15) species <- c(species, "Anchoveta")
if (spanishsardine> 0.15) species <- c(species, "SpanishSardine")
n <- length(species)
if (n == 0) return("None or negligible")
if (n == 1) return(paste("Only", species[1]))
if (n == 2) return(paste(species[1], "and", species[2]))
if (n == 3) return(paste(species[1], ",", species[2], "and", species[3]))
return("All species")
}
vessel_strategies_yearly_IND <- vessel_species_year_IND %>%
mutate(strategy = pmap_chr(
list(Sardine, JackMackerel, Anchoveta, SpanishSardine),
get_strategy
))
strategy_percent_IND <- vessel_strategies_yearly_IND %>%
group_by(strategy) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(percent = round(100 * n / sum(n), 1)) %>%
arrange(desc(percent)) %>%
mutate(sector = "Industrial")
#####################################################
# 7 barcos de factoria que capturan puro JUREL!
# ind_harvest_SERNAPESCA_BF <-
#   read_excel(paste0(dirdata, "SERNAPESCA/AH010T0006857_sobre_desembarque_pelagicos_2012_2024.xlsx"),
#              sheet = "BF_2017_2024",
#              range = "A7:R144") %>%
#   rename(specie = DESCR1TABL,
#          year = Año,
#          region = `Cd_Region`,
#          vessel_id = `CD_MATRICU`) %>%
#   mutate(zone = case_when(
#     region %in% c(1,2,3,4,15) ~ "Norte",
#     region %in% c(5,6,7,8,9,10,14,16) ~ "Centro-Sur",
#     region %in% c(11,12) ~ "Extremo Sur",
#     TRUE ~ "No Especifica")) %>%
#   filter(zone == "Centro-Sur")
#
# vessel_species_year_BF <- ind_harvest_SERNAPESCA_BF %>%
#   select(vessel_id, year, specie, DESEMBARQUE) %>%
#   group_by(vessel_id, year, specie) %>%
#   summarize(total_catch = sum(DESEMBARQUE, na.rm = TRUE)) %>%
#   group_by(vessel_id, year) %>%
#   mutate(species_share = total_catch / sum(total_catch, na.rm = TRUE)) %>%
#   ungroup() %>%
#   select(-c(total_catch)) %>%
#   pivot_wider(
#     names_from = specie,
#     values_from = species_share,
#     values_fill = 0
#   )
# -----  Merge -----
strategy_all <- bind_rows(
strategy_percent_ART,
strategy_percent_IND
) %>%
arrange(sector, desc(percent))
strategy_wide <- strategy_all %>%
select(strategy, sector, n) %>%
pivot_wider(names_from = sector, values_from = n, values_fill = 0) %>%
mutate(Total = SmallScale + Industrial) %>%
mutate(Percent = round(100 * Total / sum(Total), 1)) %>%
arrange(desc(Percent))
rm(list = c("ind_harvest_SERNAPESCA_IND", "ind_harvest_SERNAPESCA_ART",
"vessel_strategies_yearly_IND", "vessel_strategies_yearly_ART",
"vessel_species_year_IND", "vessel_species_year_ART",
"strategy_percent_ART", "strategy_percent_IND", "strategy_all"))
library(knitr)
kable(strategy_wide, format = "markdown",
col.names = c("Strategy", "Industrial", "Small-Scale", "Total", "Percent (%)"))
rm(list = c("strategy_wide"))
library(readxl)
library(dplyr)
library(tidyr)
library(purrr)
library(lubridate)
### Load logbooks information for central-south Chile
logbooks <-
read_excel(paste0(dirdata, "IFOP/1. BITACORA CENTRO SUR.xlsx"),
sheet = "bIt_2001_2024_comercial") %>%
filter(REGION %in% c(5,6,7,8,9,10,14,16))
### Get species name in logbooks
species <-
read_excel(
paste0(dirdata, "IFOP/1. BITACORA CENTRO SUR.xlsx"),
sheet = "PESQUERIAS_MAESTRO_ESPECIE") %>%
dplyr::select(c('COD_ESPECIE', 'NOMBRE_ESPECIE'))
logbooks <- left_join(logbooks, species, by = "COD_ESPECIE")
logbooks$year <- year(logbooks$FECHA_HORA_RECALADA)
logbooks$month <- month(logbooks$FECHA_HORA_RECALADA)
# First, get your original summarized table
vessel_species_year <- logbooks %>%
select(COD_BARCO, year, NOMBRE_ESPECIE, CAPTURA_RETENIDA) %>%
group_by(COD_BARCO, year, NOMBRE_ESPECIE) %>%
summarize(total_catch = sum(CAPTURA_RETENIDA, na.rm = TRUE), .groups = "drop") %>%
group_by(COD_BARCO, year) %>%
mutate(species_share = total_catch / sum(total_catch, na.rm = TRUE)) %>%
ungroup() %>%
select(-total_catch) %>%
complete(COD_BARCO, year, NOMBRE_ESPECIE, fill = list(species_share = 0)) %>%
group_by(COD_BARCO, year) %>%
mutate(species_share_check = sum(species_share, na.rm = TRUE)) %>%
filter(species_share_check > 0) %>%
dplyr::select(-c(species_share_check)) %>%
group_by(COD_BARCO, NOMBRE_ESPECIE) %>%
summarize(species_share = mean(species_share, na.rm = TRUE)) %>%
pivot_wider(
names_from = NOMBRE_ESPECIE,
values_from = species_share,
values_fill = 0) %>%
dplyr::select(c(COD_BARCO, ANCHOVETA, `SARDINA COMUN`, JUREL,
`SARDINA ESPANOLA`, `SARDINAS SIN IDENTIFICAR`)) %>%
mutate(OTHER = 1 - ANCHOVETA - `SARDINA COMUN` - JUREL - `SARDINA ESPANOLA` -
`SARDINAS SIN IDENTIFICAR`) %>%
rename(
Anchoveta = `ANCHOVETA`,
Sardine = `SARDINA COMUN`,
JackMackerel = `JUREL`,
SpanishSardine = `SARDINA ESPANOLA`,
SardineNA = `SARDINAS SIN IDENTIFICAR`,
Other = `OTHER`
)
get_strategy <- function(sardine, jackmackerel, anchoveta, sardinena, spanishsardine, other) {
species <- c()
if (sardine > 0.15) species <- c(species, "Sardine")
if (jackmackerel > 0.15) species <- c(species, "JackMackerel")
if (anchoveta > 0.15) species <- c(species, "Anchoveta")
if (spanishsardine > 0.15) species <- c(species, "SpanishSardine")
if (sardinena > 0.15) species <- c(species, "SardineNA")
if (other > 0.15) species <- c(species, "Other")
n <- length(species)
if (n == 0) return("None or negligible")
if (n == 1) return(paste("Only", species[1]))
if (n == 2) return(paste(species[1], "and", species[2]))
if (n == 3) return(paste(species[1], ",", species[2], "and", species[3]))
if (n == 4) return(paste(species[1], ",", species[2], ",", species[3], "and", species[4]))
if (n == 5) return(paste(species[1], ",", species[2], ",",
species[3], ",", species[4], "and", species[5]))
return(paste(species[1], ",", species[2], ",", species[3], ",",
species[4], ",", species[5] , "and", species[6]))
}
vessel_species_year <- vessel_species_year %>%
mutate(strategy = pmap_chr(
list(Sardine, JackMackerel, Anchoveta, SpanishSardine, SardineNA, Other),
get_strategy
))
strategy_percent <- vessel_species_year %>%
group_by(strategy) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(percent = round(100 * n / sum(n), 1)) %>%
arrange(desc(percent))
View(strategy_percent)
library(knitr)
kable(strategy_percent, format = "markdown",
col.names = c("Strategy", "Total", "Percent (%)"))
rm(list = c("strategy_percent"))
library(readxl)
library(dplyr)
annual_harvest_SERNAPESCA_ART <-
read_excel(paste0(dirdata, "SERNAPESCA/AH010T0006857_sobre_desembarque_pelagicos_2012_2024.xlsx"),
sheet = "ART_2012_2024",
range = "A6:S36337") %>%
rename(specie = Especie,
year = Año,
region = `Región de Operación`) %>%
mutate(zone = case_when(
region %in% c(1,2,3,4,15) ~ "Norte",
region %in% c(5,6,7,8,9,10,14,16) ~ "Centro_Sur",
region %in% c(11,12) ~ "Extremo_Sur",
TRUE ~ "No_Especifica"
)) %>%
group_by(specie, year, zone) %>%
summarize(annual_harvest_ART_SERNAPESCA = sum(SumaDeDesembarque, na.rm = TRUE), .groups = "drop")
annual_harvest_SERNAPESCA_IND <-
read_excel(paste0(dirdata, "SERNAPESCA/AH010T0006857_sobre_desembarque_pelagicos_2012_2024.xlsx"),
sheet = "IND_2012_2024",
range = "A6:R3349") %>%
rename(specie = Especie,
year = Año,
region = `Región`) %>%
mutate(zone = case_when(
region %in% c(1,2,3,4,15) ~ "Norte",
region %in% c(5,6,7,8,9,10,14,16) ~ "Centro_Sur",
region %in% c(11,12) ~ "Extremo_Sur",
TRUE ~ "No_Especifica"
)) %>%
group_by(specie, year, zone) %>%
summarize(annual_harvest_IND_SERNAPESCA = sum(Desembarque, na.rm = TRUE), .groups = "drop")
annual_harvest_SERNAPESCA_BF <-
read_excel(paste0(dirdata, "SERNAPESCA/AH010T0006857_sobre_desembarque_pelagicos_2012_2024.xlsx"),
sheet = "BF_2017_2024",
range = "A7:R144") %>%
rename(specie = DESCR1TABL,
year = Año,
region = `Cd_Region`) %>%
mutate(zone = case_when(
region %in% c(1,2,3,4,15) ~ "Norte",
region %in% c(5,6,7,8,9,10,14,16) ~ "Centro_Sur",
region %in% c(11,12) ~ "Extremo_Sur",
TRUE ~ "No_Especifica"
)) %>%
group_by(specie, year, zone) %>%
summarize(annual_harvest_BF_SERNAPESCA = sum(DESEMBARQUE, na.rm = TRUE), .groups = "drop")
harvest_SERNAPESCA <-
left_join(annual_harvest_SERNAPESCA_ART, annual_harvest_SERNAPESCA_IND, by = c("year", "specie", "zone")) %>%
left_join(annual_harvest_SERNAPESCA_BF, by = c("year", "specie", "zone")) %>%
mutate(total_harvest_SERNAPESCA = rowSums(across(c(annual_harvest_IND_SERNAPESCA, annual_harvest_ART_SERNAPESCA)), na.rm = TRUE)) %>%
mutate(total_harvest_all_SERNAPESCA = rowSums(across(c(annual_harvest_IND_SERNAPESCA, annual_harvest_BF_SERNAPESCA, annual_harvest_ART_SERNAPESCA)), na.rm = TRUE))
harvest_SERNAPESCA <- harvest_SERNAPESCA %>%
pivot_wider(
names_from = zone,
values_from = c(
annual_harvest_ART_SERNAPESCA,
annual_harvest_IND_SERNAPESCA,
annual_harvest_BF_SERNAPESCA,
total_harvest_SERNAPESCA,
total_harvest_all_SERNAPESCA
),
names_sep = "_"
)
rm(list = c("annual_harvest_SERNAPESCA_ART", "annual_harvest_SERNAPESCA_IND", "annual_harvest_SERNAPESCA_BF"))
strategy_percent <- vessel_species_year %>%
group_by(strategy) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(percent = round(100 * n / sum(n), 1)) %>%
arrange(desc(percent))
library(knitr)
kable(strategy_percent, format = "markdown",
col.names = c("Strategy", "Total", "Percent (%)"))
rm(list = c("strategy_percent"))
library(readxl)
library(dplyr)
library(tidyr)
library(purrr)
library(lubridate)
### Load logbooks information for central-south Chile
logbooks <-
read_excel(paste0(dirdata, "IFOP/1. BITACORA CENTRO SUR.xlsx"),
sheet = "bIt_2001_2024_comercial") %>%
filter(REGION %in% c(5,6,7,8,9,10,14,16))
### Get species name in logbooks
species <-
read_excel(
paste0(dirdata, "IFOP/1. BITACORA CENTRO SUR.xlsx"),
sheet = "PESQUERIAS_MAESTRO_ESPECIE") %>%
dplyr::select(c('COD_ESPECIE', 'NOMBRE_ESPECIE'))
logbooks <- left_join(logbooks, species, by = "COD_ESPECIE")
logbooks$year <- year(logbooks$FECHA_HORA_RECALADA)
logbooks$month <- month(logbooks$FECHA_HORA_RECALADA)
# First, get your original summarized table
vessel_species_year <- logbooks %>%
select(COD_BARCO, year, NOMBRE_ESPECIE, CAPTURA_RETENIDA) %>%
group_by(COD_BARCO, year, NOMBRE_ESPECIE) %>%
summarize(total_catch = sum(CAPTURA_RETENIDA, na.rm = TRUE), .groups = "drop") %>%
group_by(COD_BARCO, year) %>%
mutate(species_share = total_catch / sum(total_catch, na.rm = TRUE)) %>%
ungroup() %>%
select(-total_catch) %>%
complete(COD_BARCO, year, NOMBRE_ESPECIE, fill = list(species_share = 0)) %>%
group_by(COD_BARCO, year) %>%
mutate(species_share_check = sum(species_share, na.rm = TRUE)) %>%
filter(species_share_check > 0) %>%
dplyr::select(-c(species_share_check)) %>%
group_by(COD_BARCO, NOMBRE_ESPECIE) %>%
summarize(species_share = mean(species_share, na.rm = TRUE)) %>%
pivot_wider(
names_from = NOMBRE_ESPECIE,
values_from = species_share,
values_fill = 0) %>%
dplyr::select(c(COD_BARCO, ANCHOVETA, `SARDINA COMUN`, JUREL,
`SARDINA ESPANOLA`, `SARDINAS SIN IDENTIFICAR`)) %>%
mutate(OTHER = 1 - ANCHOVETA - `SARDINA COMUN` - JUREL - `SARDINA ESPANOLA` -
`SARDINAS SIN IDENTIFICAR`) %>%
rename(
Anchoveta = `ANCHOVETA`,
Sardine = `SARDINA COMUN`,
JackMackerel = `JUREL`,
SpanishSardine = `SARDINA ESPANOLA`,
SardineNA = `SARDINAS SIN IDENTIFICAR`,
Other = `OTHER`
)
get_strategy <- function(sardine, jackmackerel, anchoveta, sardinena, spanishsardine, other) {
species <- c()
if (sardine > 0.15) species <- c(species, "Sardine")
if (jackmackerel > 0.15) species <- c(species, "JackMackerel")
if (anchoveta > 0.15) species <- c(species, "Anchoveta")
if (spanishsardine > 0.15) species <- c(species, "SpanishSardine")
if (sardinena > 0.15) species <- c(species, "SardineNA")
if (other > 0.15) species <- c(species, "Other")
n <- length(species)
if (n == 0) return("None or negligible")
if (n == 1) return(paste("Only", species[1]))
if (n == 2) return(paste(species[1], "and", species[2]))
if (n == 3) return(paste(species[1], ",", species[2], "and", species[3]))
if (n == 4) return(paste(species[1], ",", species[2], ",", species[3], "and", species[4]))
if (n == 5) return(paste(species[1], ",", species[2], ",",
species[3], ",", species[4], "and", species[5]))
return(paste(species[1], ",", species[2], ",", species[3], ",",
species[4], ",", species[5] , "and", species[6]))
}
vessel_species_year <- vessel_species_year %>%
mutate(strategy = pmap_chr(
list(Sardine, JackMackerel, Anchoveta, SpanishSardine, SardineNA, Other),
get_strategy
))
strategy_percent <- vessel_species_year %>%
group_by(strategy) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(percent = round(100 * n / sum(n), 1)) %>%
arrange(desc(percent))
