sur_df <- readRDS("tables/table_SUR_stock.rds")
sur_df <- sur_df %>% mutate(across(everything(), ~ifelse(is.na(.), "&mdash;", .)))
# Build a clean gt table with section dividers + smaller text
# nice em dashes for NA
sur_df <- sur_df %>% mutate(across(-term, ~ifelse(is.na(.), "—", .)))
# row indices for groups
idx_bio  <- 1:3
idx_env  <- 4:7
idx_xsp  <- 8:10
idx_fit  <- 11
tab <- sur_df |>
gt(rowname_col = "term") |>
# Header + spanner
tab_header(
title = md("**Seemingly Unrelated Regression (SUR) estimates of biomass dynamics for small pelagic species in Central–Southern Chile.**")
) |>
tab_spanner(label = "Species", columns = c(Sardine, Anchoveta, `JackMackerel`)) |>
cols_label(
Sardine = md("*Sardine*"),
Anchoveta = md("*Anchoveta*"),
`JackMackerel` = md("*Jack mackerel*")
) |>
# Group rows (top → bottom order)
tab_row_group(label = "Biomass dynamics",        rows = idx_bio) |>
tab_row_group(label = "Environmental effects",   rows = idx_env) |>
tab_row_group(label = "Cross-species interactions", rows = idx_xsp) |>
tab_row_group(label = "Model fit",               rows = idx_fit) |>
row_group_order(c("Biomass dynamics","Environmental effects","Cross-species interactions","Model fit")) |>
# Compact, clean theme
opt_table_font(font = list(google_font("Source Serif 4"), default_fonts())) |>
tab_options(
table.width = px(820),
table.font.size = px(15),         # adjust if you need smaller/bigger
data_row.padding = px(3),
row_group.padding = px(6),
heading.title.font.size = px(18),
column_labels.background.color = "white",
table.border.top.color = "black",
table.border.top.width = px(2),
table.border.bottom.color = "black",
table.border.bottom.width = px(2),
row_group.background.color = "#f7f7f7",
row_group.border.top.color = "#bdbdbd",
row_group.border.top.width = px(1),
row_group.border.bottom.color = "#bdbdbd",
row_group.border.bottom.width = px(1)
) |>
# crisp inner gridlines
tab_style(
style = cell_borders(sides = "top", color = "#d0d0d0", weight = px(1)),
locations = cells_body(rows = everything())
) |>
# bold section starts
tab_style(
style = cell_text(weight = "bold"),
locations = cells_body(rows = c(idx_bio[1], idx_env[1], idx_xsp[1], idx_fit[1]))
) |>
# note
tab_source_note(md("Entries are coefficients; significance: * p<0.10, ** p<0.05, *** p<0.01. Quadratic terms shown with “sq”; interactions use ×."))
# Save as a crisp PNG (works 100% in xaringan)
gtsave(tab, "tables/table_SUR_stock.png", vwidth = 1000, vheight = 900, zoom = 1.2)
knitr::include_graphics("tables/table_SUR_stock.png")
ac_data <- read_csv('ac_renters.csv')
library(tidyverse)
ac_data <- read_csv('ac_renters.csv')
options(htmltools.dir.version = FALSE)
library(RefManageR)
source(here::here("helper.R"))
BibOptions(check.entries = FALSE,
bib.style = "authoryear",
style = "markdown",
dashed = TRUE)
bib <- ReadBib("bibliography.bib")
citeopt <- list(max.names=3, longnamesfirst = FALSE)
xaringanExtra::use_logo("https://fquezadae.github.io/Slides-Econometria/figs/depto_economia_blanco.png")
library(dplyr)
library(knitr)
library(kableExtra)
library(gt)
sur_df <- readRDS("tables/table_SUR_stock.rds")
sur_df <- sur_df %>% mutate(across(everything(), ~ifelse(is.na(.), "&mdash;", .)))
# Build a clean gt table with section dividers + smaller text
# nice em dashes for NA
sur_df <- sur_df %>% mutate(across(-term, ~ifelse(is.na(.), "—", .)))
# row indices for groups
idx_bio  <- 1:3
idx_env  <- 4:7
idx_xsp  <- 8:10
idx_fit  <- 11
tab <- sur_df |>
gt(rowname_col = "term") |>
# Header + spanner
tab_header(
title = md("**Seemingly Unrelated Regression (SUR) estimates of biomass dynamics for small pelagic species in Central–Southern Chile.**")
) |>
tab_spanner(label = "Species", columns = c(Sardine, Anchoveta, `JackMackerel`)) |>
cols_label(
Sardine = md("*Sardine*"),
Anchoveta = md("*Anchoveta*"),
`JackMackerel` = md("*Jack mackerel*")
) |>
# Group rows (top → bottom order)
tab_row_group(label = "Biomass dynamics",        rows = idx_bio) |>
tab_row_group(label = "Environmental effects",   rows = idx_env) |>
tab_row_group(label = "Cross-species interactions", rows = idx_xsp) |>
tab_row_group(label = "Model fit",               rows = idx_fit) |>
row_group_order(c("Biomass dynamics","Environmental effects","Cross-species interactions","Model fit")) |>
# Compact, clean theme
opt_table_font(font = list(google_font("Source Serif 4"), default_fonts())) |>
tab_options(
table.width = px(820),
table.font.size = px(15),         # adjust if you need smaller/bigger
data_row.padding = px(3),
row_group.padding = px(6),
heading.title.font.size = px(18),
column_labels.background.color = "white",
table.border.top.color = "black",
table.border.top.width = px(2),
table.border.bottom.color = "black",
table.border.bottom.width = px(2),
row_group.background.color = "#f7f7f7",
row_group.border.top.color = "#bdbdbd",
row_group.border.top.width = px(1),
row_group.border.bottom.color = "#bdbdbd",
row_group.border.bottom.width = px(1)
) |>
# crisp inner gridlines
tab_style(
style = cell_borders(sides = "top", color = "#d0d0d0", weight = px(1)),
locations = cells_body(rows = everything())
) |>
# bold section starts
tab_style(
style = cell_text(weight = "bold"),
locations = cells_body(rows = c(idx_bio[1], idx_env[1], idx_xsp[1], idx_fit[1]))
) |>
# note
tab_source_note(md("Entries are coefficients; significance: * p<0.10, ** p<0.05, *** p<0.01. Quadratic terms shown with “sq”; interactions use ×."))
# Save as a crisp PNG (works 100% in xaringan)
gtsave(tab, "tables/table_SUR_stock.png", vwidth = 1000, vheight = 900, zoom = 1)
knitr::include_graphics("tables/table_SUR_stock.png")
View(sur_df)
library(dplyr)
library(knitr)
library(kableExtra)
library(gt)
sur_df <- readRDS("tables/table_SUR_stock.rds")
sur_df <- sur_df %>% mutate(across(everything(), ~ifelse(is.na(.), "&mdash;", .)))
# Build a clean gt table with section dividers + smaller text
# nice em dashes for NA
sur_df <- sur_df %>% mutate(across(-term, ~ifelse(is.na(.), "-", .)))
# row indices for groups
idx_bio  <- 1:3
idx_env  <- 4:7
idx_xsp  <- 8:10
idx_fit  <- 11
tab <- sur_df |>
gt(rowname_col = "term") |>
# Header + spanner
tab_header(
title = md("**Seemingly Unrelated Regression (SUR) estimates of biomass dynamics for small pelagic species in Central–Southern Chile.**")
) |>
tab_spanner(label = "Species", columns = c(Sardine, Anchoveta, `JackMackerel`)) |>
cols_label(
Sardine = md("*Sardine*"),
Anchoveta = md("*Anchoveta*"),
`JackMackerel` = md("*Jack mackerel*")
) |>
# Group rows (top → bottom order)
tab_row_group(label = "Biomass dynamics",        rows = idx_bio) |>
tab_row_group(label = "Environmental effects",   rows = idx_env) |>
tab_row_group(label = "Cross-species interactions", rows = idx_xsp) |>
tab_row_group(label = "Model fit",               rows = idx_fit) |>
row_group_order(c("Biomass dynamics","Environmental effects","Cross-species interactions","Model fit")) |>
# Compact, clean theme
opt_table_font(font = list(google_font("Source Serif 4"), default_fonts())) |>
tab_options(
table.width = px(820),
table.font.size = px(15),         # adjust if you need smaller/bigger
data_row.padding = px(3),
row_group.padding = px(6),
heading.title.font.size = px(18),
column_labels.background.color = "white",
table.border.top.color = "black",
table.border.top.width = px(2),
table.border.bottom.color = "black",
table.border.bottom.width = px(2),
row_group.background.color = "#f7f7f7",
row_group.border.top.color = "#bdbdbd",
row_group.border.top.width = px(1),
row_group.border.bottom.color = "#bdbdbd",
row_group.border.bottom.width = px(1)
) |>
# crisp inner gridlines
tab_style(
style = cell_borders(sides = "top", color = "#d0d0d0", weight = px(1)),
locations = cells_body(rows = everything())
) |>
# bold section starts
tab_style(
style = cell_text(weight = "bold"),
locations = cells_body(rows = c(idx_bio[1], idx_env[1], idx_xsp[1], idx_fit[1]))
) |>
# note
tab_source_note(md("Entries are coefficients; significance: * p<0.10, ** p<0.05, *** p<0.01. Quadratic terms shown with “sq”; interactions use ×."))
# Save as a crisp PNG (works 100% in xaringan)
gtsave(tab, "tables/table_SUR_stock.png", vwidth = 1000, vheight = 900, zoom = 1)
View(sur_df)
library(dplyr)
library(knitr)
library(kableExtra)
library(gt)
sur_df <- readRDS("tables/table_SUR_stock.rds")
# Build a clean gt table with section dividers + smaller text
# nice em dashes for NA
sur_df <- sur_df %>% mutate(across(-term, ~ifelse(is.na(.), "-", .)))
# row indices for groups
idx_bio  <- 1:3
idx_env  <- 4:7
idx_xsp  <- 8:10
idx_fit  <- 11
tab <- sur_df |>
gt(rowname_col = "term") |>
# Header + spanner
tab_header(
title = md("**Seemingly Unrelated Regression (SUR) estimates of biomass dynamics for small pelagic species in Central–Southern Chile.**")
) |>
tab_spanner(label = "Species", columns = c(Sardine, Anchoveta, `JackMackerel`)) |>
cols_label(
Sardine = md("*Sardine*"),
Anchoveta = md("*Anchoveta*"),
`JackMackerel` = md("*Jack mackerel*")
) |>
# Group rows (top → bottom order)
tab_row_group(label = "Biomass dynamics",        rows = idx_bio) |>
tab_row_group(label = "Environmental effects",   rows = idx_env) |>
tab_row_group(label = "Cross-species interactions", rows = idx_xsp) |>
tab_row_group(label = "Model fit",               rows = idx_fit) |>
row_group_order(c("Biomass dynamics","Environmental effects","Cross-species interactions","Model fit")) |>
# Compact, clean theme
opt_table_font(font = list(google_font("Source Serif 4"), default_fonts())) |>
tab_options(
table.width = px(820),
table.font.size = px(15),         # adjust if you need smaller/bigger
data_row.padding = px(3),
row_group.padding = px(6),
heading.title.font.size = px(18),
column_labels.background.color = "white",
table.border.top.color = "black",
table.border.top.width = px(2),
table.border.bottom.color = "black",
table.border.bottom.width = px(2),
row_group.background.color = "#f7f7f7",
row_group.border.top.color = "#bdbdbd",
row_group.border.top.width = px(1),
row_group.border.bottom.color = "#bdbdbd",
row_group.border.bottom.width = px(1)
) |>
# crisp inner gridlines
tab_style(
style = cell_borders(sides = "top", color = "#d0d0d0", weight = px(1)),
locations = cells_body(rows = everything())
) |>
# bold section starts
tab_style(
style = cell_text(weight = "bold"),
locations = cells_body(rows = c(idx_bio[1], idx_env[1], idx_xsp[1], idx_fit[1]))
) |>
# note
tab_source_note(md("Entries are coefficients; significance: * p<0.10, ** p<0.05, *** p<0.01. Quadratic terms shown with “sq”; interactions use ×."))
# Save as a crisp PNG (works 100% in xaringan)
gtsave(tab, "tables/table_SUR_stock.png", vwidth = 1000, vheight = 900, zoom = 1)
View(sur_df)
knitr::include_graphics("tables/table_SUR_stock.png")
gtsave(tab, "tables/table_SUR_stock.pdf", vwidth = 1000, vheight = 900, zoom = 1)
gtsave(tab, "tables/table_SUR_stock.pdf", vwidth = 2000, vheight = 1800, zoom = 1)
gtsave(tab, "tables/table_SUR_stock.pdf", vwidth = 4000, vheight = 3600, zoom = 1)
gtsave(tab, "tables/table_SUR_stock.pdf", vwidth = 4000, vheight = 3600, zoom = 2)
gtsave(tab, "tables/table_SUR_stock.png", vwidth = 4000, vheight = 3600, zoom = 2)
gtsave(tab, "tables/table_SUR_stock.png", vwidth = 4000, vheight = 3600, zoom = 5)
gtsave(tab, "tables/table_SUR_stock.png", vwidth = 4000, vheight = 3600, zoom = 10)
View(bib)
View(citeopt)
library(RefManageR)
source(here::here("helper.R"))
BibOptions(biblatex = TRUE,          # <<< clave
check.entries = FALSE,
bib.style = "authoryear",
style = "markdown",
dashed = TRUE)
View(bib)
library(RefManageR)
source(here::here("helper.R"))
BibOptions(check.entries = FALSE,
bib.style = "authoryear",
style = "markdown",
dashed = TRUE)
bib <- ReadBib("bibliography.bib")
citeopt <- list(max.names=3, longnamesfirst = FALSE)
View(bib)
library(dplyr)
library(tidyr)
library(ggplot2)
library(ggalluvial)
library(patchwork)
library(ggrepel)
strategy_transitions <- full_join(strategy_before, strategy_after, by = c("COD_BARCO", "TIPO_FLOTA")) %>%
mutate(
strategy_Before = ifelse(is.na(strategy_Before), "No fishing", strategy_Before),
strategy_After  = ifelse(is.na(strategy_After),  "No fishing", strategy_After)
) %>% filter(TIPO_FLOTA == "ART")
magick::image_read_pdf("figs/strategy_transitions_ART.pdf",
pages = 1)
###----------------------------------------------###
###   Environmental data: distance to coast      ###
###----------------------------------------------###
rm(list = ls())
gc()
library(dplyr)
library(data.table)
library(lubridate)
library(sf)
library(rnaturalearth)
#---------------------------------
# Load dataset
#---------------------------------
usuario <- Sys.info()[["user"]]
dirdata <- paste0("C:/Users/", usuario,
"/OneDrive - Universidad de Concepción/FONDECYT Iniciacion/Data/")
env_dt <- readRDS("data/env/2000-2011/EnvMergedDaily_2000_2011_0.25deg.rds")
#---------------------------------
# Unique grid cells
#---------------------------------
grid_coords <- env_dt %>%
select(lon, lat) %>%
distinct()
grid_sf <- st_as_sf(grid_coords, coords = c("lon", "lat"), crs = 4326) %>%
st_transform(32719)  # UTM 19S
#---------------------------------
# Chile continental (mainland only)
#---------------------------------
chile_mainland <- ne_countries(scale = "medium", returnclass = "sf") %>%
filter(admin == "Chile") %>%
st_union() %>%
st_cast("POLYGON") %>%
(\(x) x[which.max(st_area(x))])() %>%
st_transform(32719)
#---------------------------------
# Buffer de 200 nm (~370.4 km)
#---------------------------------
nm200 <- 200 * 1852   # metros
chile_buffer <- st_buffer(chile_mainland, dist = nm200)
#---------------------------------
# Polígono de toda Sudamérica (para quitar tierra)
#---------------------------------
south_america <- ne_countries(scale = "medium", returnclass = "sf") %>%
filter(continent == "South America") %>%
st_union() %>%
st_transform(32719)
#---------------------------------
# Zona de mar = buffer ∩ (no tierra)
#---------------------------------
sea_area <- st_difference(chile_buffer, south_america)
#---------------------------------
# Filtrar solo grilla en el mar
#---------------------------------
inside_sea <- st_intersects(grid_sf, sea_area, sparse = FALSE)[,1]
grid_filtered <- grid_sf[inside_sea, ]
#---------------------------------
# Distancias a la costa
#---------------------------------
grid_filtered$dist2coast_m  <- as.numeric(st_distance(grid_filtered, chile_mainland))
grid_filtered$dist2coast_km <- grid_filtered$dist2coast_m / 1000
#---------------------------------
# Extraer lon/lat de nuevo para merge
#---------------------------------
grid_filtered_lonlat <- st_transform(grid_filtered, 4326) %>%
mutate(lon = st_coordinates(.)[,1],
lat = st_coordinates(.)[,2]) %>%
st_drop_geometry() %>%
as.data.table()
#---------------------------------
# Merge con dataset original
#---------------------------------
keep_cells <- grid_filtered_lonlat %>%
select(lon, lat, dist2coast_m, dist2coast_km)
env_coast_dt <- env_dt %>%
semi_join(keep_cells, by = c("lon", "lat")) %>%
left_join(keep_cells, by = c("lon", "lat"))
#---------------------------------
# Guardar dataset final
#---------------------------------
saveRDS(env_coast_dt,
file = "data/env/2000-2011/EnvCoastDaily_2000_2011_0.25deg.rds")
#---------------------------------
# Chequeo rápido
#---------------------------------
cat("Celdas originales:", nrow(env_dt %>% distinct(lon, lat)), "\n")
cat("Celdas filtradas :", nrow(env_coast_dt %>% distinct(lon, lat)), "\n")
library(ggplot2)
# Pasar todo a lat/lon (EPSG:4326) para graficar
chile_plot   <- st_transform(chile_mainland, 4326)
buffer_plot  <- st_transform(chile_buffer, 4326)
sea_plot     <- st_transform(sea_area, 4326)
grid_plot    <- st_as_sf(grid_filtered, crs = 32719) %>%
st_transform(4326)
ggplot() +
geom_sf(data = buffer_plot, fill = "lightblue", color = NA, alpha = 0.3) +
geom_sf(data = sea_plot, fill = "lightblue", color = "blue", alpha = 0.2) +
geom_sf(data = chile_plot, fill = "gray60", color = "black") +
geom_sf(data = grid_plot, aes(color = dist2coast_km), size = 0.4) +
scale_color_viridis_c(option = "plasma", name = "Distancia costa (km)") +
coord_sf(xlim = c(-82, -70), ylim = c(-42, -30)) +
theme_minimal() +
labs(title = "Zona marítima chilena (≤ 200 nm, solo mar)",
subtitle = "Grid ambiental 0.125° filtrado frente a Chile continental",
x = "Longitud", y = "Latitud")
ggsave("figsenv_data_map.svg", p,
device = svglite::svglite, width = 10, height = 6, units = "in")
p <- ggplot() +
geom_sf(data = buffer_plot, fill = "lightblue", color = NA, alpha = 0.3) +
geom_sf(data = sea_plot, fill = "lightblue", color = "blue", alpha = 0.2) +
geom_sf(data = chile_plot, fill = "gray60", color = "black") +
geom_sf(data = grid_plot, aes(color = dist2coast_km), size = 0.4) +
scale_color_viridis_c(option = "plasma", name = "Distancia costa (km)") +
coord_sf(xlim = c(-82, -70), ylim = c(-42, -30)) +
theme_minimal() +
labs(title = "Zona marítima chilena (≤ 200 nm, solo mar)",
subtitle = "Grid ambiental 0.125° filtrado frente a Chile continental",
x = "Longitud", y = "Latitud")
ggsave("figsenv_data_map.svg", p,
device = svglite::svglite, width = 6, height = 10, units = "in")
ggsave("figs/env_data_map.svg", p,
device = svglite::svglite, width = 6, height = 10, units = "in")
ggsave("figs/env_data_map.svg", p,
device = svglite::svglite)
install.packages("gt")
install.packages("gt")
options(htmltools.dir.version = FALSE)
library(dplyr)
library(knitr)
library(kableExtra)
library(gt)
sur_df <- readRDS("tables/table_SUR_stock.rds")
rm(list = ls())
gc()
# Definir directorios según usuario
usuario <- Sys.info()[["user"]]
# computador <- Sys.info()[["nodename"]]  # Alternativamente puedes usar esto
if (usuario == "felip") {
dirdata <- "C:/Users/felip/OneDrive - Universidad de Concepción/FONDECYT Iniciacion/Data/"
} else if (usuario == "FACEA") {
dirdata <- "C:/Users/FACEA/OneDrive - Universidad de Concepción/FONDECYT Iniciacion/Data/"
} else {
stop("Usuario no reconocido. Defina el directorio correspondiente.")
}
rm(usuario)
env_dt <- readRDS("data/env/EnvCoastDaily_2012_2025_0.125deg.rds")
fit_biomasa <- fit_no_wind
rm(list = ls())
gc()
# Definir directorios según usuario
usuario <- Sys.info()[["user"]]
# computador <- Sys.info()[["nodename"]]  # Alternativamente puedes usar esto
if (usuario == "felip") {
dirdata <- "C:/Users/felip/OneDrive - Universidad de Concepción/FONDECYT Iniciacion/Data/"
} else if (usuario == "FACEA") {
dirdata <- "C:/Users/FACEA/OneDrive - Universidad de Concepción/FONDECYT Iniciacion/Data/"
} else {
stop("Usuario no reconocido. Defina el directorio correspondiente.")
}
rm(usuario)
env_dt <- readRDS("data/env/EnvCoastDaily_2012_2025_0.125deg.rds")
detach("package:gt", unload = TRUE)
rm(list = ls())
gc()
# Definir directorios según usuario
usuario <- Sys.info()[["user"]]
# computador <- Sys.info()[["nodename"]]  # Alternativamente puedes usar esto
if (usuario == "felip") {
dirdata <- "C:/Users/felip/OneDrive - Universidad de Concepción/FONDECYT Iniciacion/Data/"
} else if (usuario == "FACEA") {
dirdata <- "C:/Users/FACEA/OneDrive - Universidad de Concepción/FONDECYT Iniciacion/Data/"
} else {
stop("Usuario no reconocido. Defina el directorio correspondiente.")
}
rm(usuario)
env_dt <- readRDS("data/env/EnvCoastDaily_2012_2025_0.125deg.rds")
rm(list = ls())
gc()
# Definir directorios según usuario
usuario <- Sys.info()[["user"]]
# computador <- Sys.info()[["nodename"]]  # Alternativamente puedes usar esto
if (usuario == "felip") {
dirdata <- "C:/Users/felip/OneDrive - Universidad de Concepción/FONDECYT Iniciacion/Data/"
} else if (usuario == "FACEA") {
dirdata <- "C:/Users/FACEA/OneDrive - Universidad de Concepción/FONDECYT Iniciacion/Data/"
} else {
stop("Usuario no reconocido. Defina el directorio correspondiente.")
}
rm(usuario)
env_dt <- readRDS("data/env/EnvCoastDaily_2012_2025_0.125deg.rds")
file.exists("data/env/EnvCoastDaily_2012_2025_0.125deg.rds")
warnings()
pagedown::chrome_print("slides.html", output = "slides.pdf")
pagedown::chrome_print("slides.html", output = "slides.pdf")
options(htmltools.dir.version = FALSE)
pagedown::chrome_print("slides.html", output = "slides.pdf")
pagedown::chrome_print("slides.html", output = "slides.pdf")
pagedown::chrome_print("slides.html", output = "slides.pdf")
pagedown::chrome_print("slides.html", output = "slides.pdf")
pagedown::chrome_print("slides.html", output = "slides.pdf")
