term %in% c("biomass_sardine:biomass_anchoveta",
"biomass_anchoveta:biomass_sardine") ~
"Sardine × Anchoveta",
term == "biomass_sardine" ~ "Biomass (Sardine, t)",
term == "biomass_anchoveta" ~ "Biomass (Anchoveta, t)",
term == "biomass_jackmackerelintrapolated" ~ "Biomass (Jack mackerel, t)",
term == "sst_c" ~ "Sea surface temperature (°C)",
term == "sst_c2" ~ "(SST)²",
term == "chl_c" ~ "Chlorophyll-a (mg/m³)",
term == "(Intercept)" ~ "Constant",
TRUE ~ term
))
# --- 3. Agregar estrellas de significancia y formatear ---
tidy_sur <- tidy_sur %>%
mutate(sig = case_when(
p.value < 0.01 ~ "***",
p.value < 0.05 ~ "**",
p.value < 0.1  ~ "*",
TRUE ~ ""
),
estimate_fmt = sprintf("%.3f%s", estimate, sig)) %>%
select(model, term, estimate_fmt)
# --- 4. Pivotear a formato tabla (una fila por variable) ---
sur_table <- tidy_sur %>%
pivot_wider(names_from = model, values_from = estimate_fmt)
# --- 5. Agregar R² ajustado ---
r2_table <- data.frame(
term = c("R-squared (Adj.)"),
Sardine = sprintf("%.3f", summary(fit_biomasa$eq[[1]])$adj.r.squared),
Anchoveta = sprintf("%.3f", summary(fit_biomasa$eq[[2]])$adj.r.squared),
JackMackerel = sprintf("%.3f", summary(fit_biomasa$eq[[3]])$adj.r.squared)
)
sur_table <- bind_rows(sur_table, r2_table)
sur_table <- sur_table %>%
select(-`Jack.mackerel`) %>%  # elimina la duplicada
rename(Variable = term)
View(sur_table)
kbl(
sur_table,
caption = "Table X. Seemingly Unrelated Regression (SUR) estimates of biomass dynamics for small pelagic species in Central-Southern Chile.",
align = "lccc",
booktabs = TRUE,
col.names = c("Variable", "Sardine", "Anchoveta", "Jack Mackerel")
) %>%
kable_styling(full_width = FALSE, position = "center") %>%
add_footnote(
label = c(
"Standard errors in parentheses. Significance levels: * p<0.1; ** p<0.05; *** p<0.01.",
"Residual correlations (ρ): Sardine–Anchoveta = −0.47; Sardine–Jack = −0.60; Anchoveta–Jack = +0.66."
),
notation = "none"
)
kbl(
sur_table,
align = "lccc",
booktabs = TRUE,
col.names = c("Variable", "Sardine", "Anchoveta", "Jack mackerel"),
escape = FALSE,
format = "latex",
label = "tab:SUR_results"
) %>%
kable_styling(latex_options = c("hold_position", "scale_down")) %>%
add_footnote(
label = c(
"Standard errors in parentheses. Significance levels: * p<0.1; ** p<0.05; *** p<0.01.",
"Residual correlations (ρ): Sardine–Anchoveta = −0.47; Sardine–Jack = −0.60; Anchoveta–Jack = +0.66."
),
notation = "none"
) %>%
save_kable("tables/biomass_results.tex")
fit_biomasa <- fit_no_chl2
rm(fit_sur, fit_no_int, fit_no_wind)
library(stargazer)
# Export each equation from your SUR fit
eq_sardine   <- fit_biomasa$eq[[1]]
eq_anchoveta <- fit_biomasa$eq[[2]]
eq_jack      <- fit_biomasa$eq[[3]]
# Pretty table in LaTeX
stargazer(
eq_sardine, eq_anchoveta, eq_jack,
type = "latex",
title = "Table X. Seemingly Unrelated Regression (SUR) estimates of biomass dynamics for small pelagic species in Central–Southern Chile.",
label = "tab:SUR_results",
dep.var.labels = c("Biomass (t+1, Sardine)", "Biomass (t+1, Anchoveta)", "Biomass (t+1, Jack mackerel)"),
covariate.labels = c(
"Biomass (Sardine, t)",
"Biomass (Anchoveta, t)",
"Biomass (Jack mackerel, t)",
"SST anomaly (°C)",
"(SST anomaly)$^2$",
"Chlorophyll-a (mg/m³)",
"Sardine × Anchoveta",
"Sardine × Jack mackerel",
"Anchoveta × Jack mackerel",
"Constant"
),
omit.stat = c("ser", "f"),
column.labels = c("Sardine", "Anchoveta", "Jack mackerel"),
column.sep.width = "1pt",
digits = 3,
notes = c("Standard errors in parentheses.",
"* p<0.10, ** p<0.05, *** p<0.01.",
"Residual correlations: Sardine–Anchoveta = −0.47; Sardine–Jack = −0.60; Anchoveta–Jack = +0.66."),
notes.append = FALSE,
out = "tables/SUR_results_stargazer.tex"
)
View(eq_sardine)
fit_biomasa <- fit_no_chl2
rm(fit_sur, fit_no_int, fit_no_wind)
library(stargazer)
# Re-crear modelos lm equivalentes
lm_sardine <- lm(formula(fit_biomasa$eq[[1]]), data = fit_biomasa$data)
library(tidyverse)
sur_df <- biomass_harvest %>%
select(
year,
biomass_t1_sardine_noharvest,
biomass_t1_anchoveta_noharvest,
biomass_t1_jackmackerel_noharvest,
biomass_sardine,
biomass_anchoveta,
biomass_jackmackerelintrapolated,
sst, chl, wind
) %>%
drop_na() %>%
mutate(
sst_c  = sst - mean(sst, na.rm = TRUE),
chl_c  = chl - mean(chl, na.rm = TRUE),
wind_c = wind - mean(wind, na.rm = TRUE),
sst_c2 = sst_c^2,
chl_c2 = chl_c^2,
wind_c2 = wind_c^2,
biomass_t1_sardine_noharvest =  biomass_t1_sardine_noharvest / 1e5,
biomass_t1_anchoveta_noharvest = biomass_t1_anchoveta_noharvest / 1e5,
biomass_t1_jackmackerel_noharvest = biomass_t1_jackmackerel_noharvest / 1e5,
biomass_sardine = biomass_sardine / 1e5,
biomass_anchoveta = biomass_anchoveta / 1e5,
biomass_jackmackerelintrapolated = biomass_jackmackerelintrapolated / 1e5
)
fit_biomasa <- fit_no_chl2
rm(fit_sur, fit_no_int, fit_no_wind)
library(stargazer)
# Re-crear modelos lm equivalentes
lm_sardine <- lm(formula(fit_biomasa$eq[[1]]), data = fit_biomasa$data)
lm_sardine <- lm(formula(fit_biomasa$eq[[1]]), data = fit_biomasa$data)
View(fit_biomasa)
# --- 1. Extract full coefficient table from systemfit ---
sur_sum <- summary(fit_biomasa)
View(sur_sum)
# Each equation’s coefficient table
eq_names <- names(sur_sum$eq)
eq_list <- lapply(eq_names, function(eq) {
data.frame(sur_sum$eq[[eq]]$coefficients) %>%
rename(Estimate = Estimate, StdError = Std..Error., t_value = t.value., p_value = Pr...t..) %>%
mutate(term = rownames(sur_sum$eq[[eq]]$coefficients),
equation = eq)
})
sur_df <- bind_rows(eq_list)
View(sur_df)
View(eq_list)
eq_names <- names(sur_sum$eq)
View(tidy_sur)
tab <- kbl(
sur_table,
align   = "lccc",
caption = "Seemingly Unrelated Regression (SUR) estimates of biomass dynamics for small pelagic species in Central--Southern Chile.",
col.names = c("Variable", "Sardine", "Anchoveta", "Jack mackerel"),
format  = "latex",
label   = "tab:SUR_results",
booktabs = TRUE,
escape  = FALSE,      # <- clave para permitir LaTeX en celdas y notas
linesep = ""          # opcional: elimina espacio extra entre filas
) %>%
kable_styling(
latex_options = c("hold_position", "scale_down"),
position = "center",
font_size = 10
) %>%
footnote(
general = c(
"Standard errors in parentheses. Significance levels: * p<0.1; ** p<0.05; *** p<0.01.",
"Residual correlations ($\\rho$): Sardine--Anchoveta = -0.47; Sardine--Jack = -0.60; Anchoveta--Jack = +0.66."
),
general_title = "",
threeparttable = TRUE,
escape = FALSE      # <- deja pasar $\\rho$ y otros comandos
)
tab
tab <- kbl(
sur_table,
align   = "lccc",
caption = "Seemingly Unrelated Regression (SUR) estimates of biomass dynamics for small pelagic species in Central--Southern Chile.",
col.names = c("Variable", "Sardine", "Anchoveta", "Jack mackerel"),
format  = "latex",
label   = "tab:SUR_results",
booktabs = TRUE,
escape  = FALSE,      # <- clave para permitir LaTeX en celdas y notas
linesep = ""          # opcional: elimina espacio extra entre filas
) %>%
kable_styling(
latex_options = c("hold_position", "scale_down"),
position = "center",
font_size = 10
) %>%
footnote(
general = c(
"Standard errors in parentheses. Significance levels: * p<0.1; ** p<0.05; *** p<0.01.",
"Residual correlations ($\rho$): Sardine--Anchoveta = -0.47; Sardine--Jack = -0.60; Anchoveta--Jack = +0.66."
),
general_title = "",
threeparttable = TRUE,
escape = FALSE      # <- deja pasar $\\rho$ y otros comandos
)
tab
tab <- kbl(
sur_table,
align   = "lccc",
caption = "Seemingly Unrelated Regression (SUR) estimates of biomass dynamics for small pelagic species in Central--Southern Chile.",
col.names = c("Variable", "Sardine", "Anchoveta", "Jack mackerel"),
format  = "latex",
label   = "tab:SUR_results",
booktabs = TRUE,
escape  = FALSE,      # <- clave para permitir LaTeX en celdas y notas
linesep = ""          # opcional: elimina espacio extra entre filas
) %>%
kable_styling(
latex_options = c("hold_position", "scale_down"),
position = "center",
font_size = 10
) %>%
footnote(
general = c(
"Standard errors in parentheses. Significance levels: * p<0.1; ** p<0.05; *** p<0.01.",
"Residual correlations ($\\rho$): Sardine--Anchoveta = -0.47; Sardine--Jack = -0.60; Anchoveta--Jack = +0.66."
),
general_title = "",
threeparttable = TRUE,
escape = FALSE      # <- deja pasar $\\rho$ y otros comandos
)
tab
tab <- kbl(
sur_table,
align   = "lccc",
caption = "Seemingly Unrelated Regression (SUR) estimates of biomass dynamics for small pelagic species in Central--Southern Chile.",
col.names = c("Variable", "Sardine", "Anchoveta", "Jack mackerel"),
format  = "latex",
label   = "SUR_results",
booktabs = TRUE,
escape  = FALSE,      # <- clave para permitir LaTeX en celdas y notas
linesep = ""          # opcional: elimina espacio extra entre filas
) %>%
kable_styling(
latex_options = c("hold_position", "scale_down"),
position = "center",
font_size = 10
) %>%
footnote(
general = c(
"Standard errors in parentheses. Significance levels: * p<0.1; ** p<0.05; *** p<0.01.",
"Residual correlations ($\\\\rho$): Sardine--Anchoveta = -0.47; Sardine--Jack = -0.60; Anchoveta--Jack = +0.66."
),
general_title = "",
threeparttable = TRUE,
escape = FALSE      # <- deja pasar $\\rho$ y otros comandos
)
tab
kbl(
sur_table,
align   = "lccc",
caption = "Seemingly Unrelated Regression (SUR) estimates of biomass dynamics for small pelagic species in Central–Southern Chile.",
col.names = c("Variable", "Sardine", "Anchoveta", "Jack mackerel"),
format  = "latex",
booktabs = TRUE,
escape  = FALSE,      # <- clave para permitir LaTeX en celdas y notas
linesep = ""          # opcional: elimina espacio extra entre filas
) %>%
kable_styling(
latex_options = c("hold_position", "scale_down"),
position = "center",
font_size = 10
) %>%
footnote(
general = c(
"Standard errors in parentheses. Significance levels: * p<0.1; ** p<0.05; *** p<0.01.",
"Residual correlations ($\\\\rho$): Sardine--Anchoveta = -0.47; Sardine--Jack = -0.60; Anchoveta--Jack = +0.66."
),
general_title = "",
threeparttable = TRUE,
escape = FALSE
) %>%
save_kable("tables/biomass_results.tex")
fit_biomasa <- fit_no_chl2
rm(fit_sur, fit_no_int, fit_no_wind)
library(dplyr)
library(tidyr)
library(kableExtra)
# --- 1. Extraer coeficientes, errores y p-values manualmente de cada ecuación ---
get_eq_df <- function(eq_obj, name){
coefs <- summary(eq_obj)$coefficients
data.frame(
term = rownames(coefs),
estimate = coefs[,1],
std.error = coefs[,2],
p.value = coefs[,4],
model = name,
row.names = NULL
)
}
tidy_sur <- bind_rows(
get_eq_df(fit_biomasa$eq[[1]], "Sardine"),
get_eq_df(fit_biomasa$eq[[2]], "Anchoveta"),
get_eq_df(fit_biomasa$eq[[3]], "JackMackerel")
)
# --- 2. Estandarizar nombres de variables e interacciones ---
tidy_sur <- tidy_sur %>%
mutate(term = case_when(
term %in% c("biomass_jackmackerelintrapolated:biomass_sardine",
"biomass_sardine:biomass_jackmackerelintrapolated") ~
"Sardine × Jack mackerel",
term %in% c("biomass_anchoveta:biomass_jackmackerelintrapolated",
"biomass_jackmackerelintrapolated:biomass_anchoveta") ~
"Anchoveta × Jack mackerel",
term %in% c("biomass_sardine:biomass_anchoveta",
"biomass_anchoveta:biomass_sardine") ~
"Sardine × Anchoveta",
term == "biomass_sardine" ~ "Biomass (Sardine, t)",
term == "biomass_anchoveta" ~ "Biomass (Anchoveta, t)",
term == "biomass_jackmackerelintrapolated" ~ "Biomass (Jack mackerel, t)",
term == "sst_c" ~ "Sea surface temperature (°C)",
term == "sst_c2" ~ "(SST)²",
term == "chl_c" ~ "Chlorophyll-a (mg/m³)",
term == "(Intercept)" ~ "Constant",
TRUE ~ term
))
# --- 3. Agregar estrellas de significancia y formatear ---
tidy_sur <- tidy_sur %>%
mutate(sig = case_when(
p.value < 0.01 ~ "***",
p.value < 0.05 ~ "**",
p.value < 0.1  ~ "*",
TRUE ~ ""
),
estimate_fmt = sprintf("%.3f%s", estimate, sig)) %>%
select(model, term, estimate_fmt)
# --- 4. Pivotear a formato tabla (una fila por variable) ---
sur_table <- tidy_sur %>%
pivot_wider(names_from = model, values_from = estimate_fmt)
# --- 5. Agregar R² ajustado ---
r2_table <- data.frame(
term = c("R-squared (Adj.)"),
Sardine = sprintf("%.3f", summary(fit_biomasa$eq[[1]])$adj.r.squared),
Anchoveta = sprintf("%.3f", summary(fit_biomasa$eq[[2]])$adj.r.squared),
JackMackerel = sprintf("%.3f", summary(fit_biomasa$eq[[3]])$adj.r.squared)
)
sur_table <- bind_rows(sur_table, r2_table)
# --- Exportar tabla a LaTeX (.tex) ---
library(kableExtra)
kbl(
sur_table,
align   = "lccc",
caption = "Seemingly Unrelated Regression (SUR) estimates of biomass dynamics for small pelagic species in Central–Southern Chile.",
col.names = c("Variable", "Sardine", "Anchoveta", "Jack mackerel"),
format  = "latex",
booktabs = TRUE,
escape  = FALSE,      # <- clave para permitir LaTeX en celdas y notas
linesep = ""          # opcional: elimina espacio extra entre filas
) %>%
kable_styling(
latex_options = c("hold_position", "scale_down"),
position = "center",
font_size = 10
) %>%
footnote(
general = c(
"Standard errors in parentheses. Significance levels: * p<0.1; ** p<0.05; *** p<0.01.",
"Residual correlations ($\\\\rho$): Sardine--Anchoveta = -0.47; Sardine--Jack = -0.60; Anchoveta--Jack = +0.66."
),
general_title = "",
threeparttable = TRUE,
escape = FALSE
) %>%
save_kable("tables/biomass_results.tex")
kbl(
sur_table,
align   = "lccc",
caption = "Seemingly Unrelated Regression (SUR) estimates of biomass dynamics for small pelagic species in Central–Southern Chile.",
col.names = c("Variable", "Sardine", "Anchoveta", "Jack mackerel"),
format  = "latex",
label   = "tab:SUR_results",
booktabs = TRUE,
escape  = FALSE,      # <- clave para permitir LaTeX en celdas y notas
linesep = ""          # opcional: elimina espacio extra entre filas
) %>%
kable_styling(
latex_options = c("hold_position", "scale_down"),
position = "center",
font_size = 10
) %>%
footnote(
general = c(
"Standard errors in parentheses. Significance levels: * p<0.1; ** p<0.05; *** p<0.01.",
"Residual correlations ($\\\\rho$): Sardine--Anchoveta = -0.47; Sardine--Jack = -0.60; Anchoveta--Jack = +0.66."
),
general_title = "",
threeparttable = TRUE,
escape = FALSE
) %>%
save_kable("tables/biomass_results.tex")
kbl(
sur_table,
align   = "lccc",
caption = "Seemingly Unrelated Regression (SUR) estimates of biomass dynamics for small pelagic species in Central–Southern Chile.",
col.names = c("Variable", "Sardine", "Anchoveta", "Jack mackerel"),
format  = "latex",
label   = "SUR_results",
booktabs = TRUE,
escape  = FALSE,      # <- clave para permitir LaTeX en celdas y notas
linesep = ""          # opcional: elimina espacio extra entre filas
) %>%
kable_styling(
latex_options = c("hold_position", "scale_down"),
position = "center",
font_size = 10
) %>%
footnote(
general = c(
"Standard errors in parentheses. Significance levels: * p<0.1; ** p<0.05; *** p<0.01.",
"Residual correlations ($\\\\rho$): Sardine--Anchoveta = -0.47; Sardine--Jack = -0.60; Anchoveta--Jack = +0.66."
),
general_title = "",
threeparttable = TRUE,
escape = FALSE
) %>%
save_kable("tables/biomass_results.tex")
kbl(
sur_table,
align   = "lccc",
caption = "\\label{tab:SUR_results}Seemingly Unrelated Regression (SUR) estimates of biomass dynamics for small pelagic species in Central--Southern Chile.",
col.names = c("Variable", "Sardine", "Anchoveta", "Jack mackerel"),
format  = "latex",
booktabs = TRUE,
escape  = FALSE,      # <- clave para permitir LaTeX en celdas y notas
linesep = ""          # opcional: elimina espacio extra entre filas
) %>%
kable_styling(
latex_options = c("hold_position", "scale_down"),
position = "center",
font_size = 10
) %>%
footnote(
general = c(
"Standard errors in parentheses. Significance levels: * p<0.1; ** p<0.05; *** p<0.01.",
"Residual correlations ($\\\\rho$): Sardine--Anchoveta = -0.47; Sardine--Jack = -0.60; Anchoveta--Jack = +0.66."
),
general_title = "",
threeparttable = TRUE,
escape = FALSE
) %>%
save_kable("tables/biomass_results.tex")
kbl(
sur_table,
align   = "lccc",
caption = "\\label{tab:SUR_results}Seemingly Unrelated Regression (SUR) estimates of biomass dynamics for small pelagic species in Central--Southern Chile.",
col.names = c("Variable", "Sardine", "Anchoveta", "Jack mackerel"),
format  = "latex",
booktabs = TRUE,
escape  = FALSE,      # <- clave para permitir LaTeX en celdas y notas
linesep = ""          # opcional: elimina espacio extra entre filas
) %>%
kable_styling(
latex_options = c("hold_position", "scale_down"),
position = "center",
font_size = 10
) %>%
footnote(
general = c(
"Standard errors in parentheses. Significance levels: * p<0.1; ** p<0.05; *** p<0.01.",
"Residual correlations ($\\\\rho$): Sardine--Anchoveta = -0.47; Sardine--Jack = -0.60; Anchoveta--Jack = +0.66."
),
general_title = "",
threeparttable = TRUE,
escape = FALSE
) %>%
save_kable("tables/biomass_results.tex")
tab <- kbl(
sur_table,
align   = "lccc",
caption = "\\label{tab:SUR_results}Seemingly Unrelated Regression (SUR) estimates of biomass dynamics for small pelagic species in Central--Southern Chile.",
col.names = c("Variable", "Sardine", "Anchoveta", "Jack mackerel"),
format  = "latex",
booktabs = TRUE,
escape  = FALSE,      # <- clave para permitir LaTeX en celdas y notas
linesep = ""          # opcional: elimina espacio extra entre filas
) %>%
kable_styling(
latex_options = c("hold_position", "scale_down"),
position = "center",
font_size = 10
) %>%
footnote(
general = c(
"Standard errors in parentheses. Significance levels: * p<0.1; ** p<0.05; *** p<0.01.",
"Residual correlations ($\\\\rho$): Sardine--Anchoveta = -0.47; Sardine--Jack = -0.60; Anchoveta--Jack = +0.66."
),
general_title = "",
threeparttable = TRUE,
escape = FALSE
)
tab
cat(tab)
fit_biomasa
summary(fit_biomasa)
