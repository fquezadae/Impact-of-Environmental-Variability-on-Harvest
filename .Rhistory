rm(list = c("anch_sard_biomass"))
ind_harvest_SERNAPESCA_ART <-
read_excel(paste0(dirdata, "SERNAPESCA/AH010T0006857_sobre_desembarque_pelagicos_2012_2024.xlsx"),
sheet = "ART_2012_2024",
range = "A6:S36337") %>%
rename(specie = Especie,
year = Año,
region = `Región de Operación`,
vessel_id = `RPA Embarcación`) %>%
mutate(zone = case_when(
region %in% c(1,2,3,4,15) ~ "Norte",
region %in% c(5,6,7,8,9,10,14,16) ~ "Centro-Sur",
region %in% c(11,12) ~ "Extremo Sur",
TRUE ~ "No Especifica"
)) %>%
filter(zone == "Centro-Sur")
View(ind_harvest_SERNAPESCA_ART)
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(annual_harvest_ART_SERNAPESCA, na.rm = TRUE), .groups = "drop") %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch))
View(ind_harvest_SERNAPESCA_ART)
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE), .groups = "drop") %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch))
View(vessel_species_year)
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE), .groups = "drop") %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch)) %>%
ungroup() %>%
filter(specie %in% c("JUREL", "SARDINA COMUN", "ANCHOVETA"))
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE), .groups = "drop") %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch)) %>%
ungroup() %>%
filter(specie %in% c("JUREL", "SARDINA COMUN", "ANCHOVETA")) %>%
pivot_wider(names_from = specie, values_from = species_share, values_fill = 0) %>%
rename(
Anchoveta = `ANCHOVETA`,
Sardine = `SARDINA COMUN`,
JackMackerel = `JUREL`
)
View(vessel_species_year)
vessel_strategies_yearly <- vessel_species_year %>%
rowwise() %>%
mutate(
max_share = max(c(Anchoveta, Sardina, Jurel)),
top_two = sort(c(Anchoveta, Sardina, Jurel), decreasing = TRUE)[1:2],
strategy = case_when(
max_share >= 0.8 ~ "Specialist",
top_two[1] >= 0.4 & top_two[2] >= 0.4 ~ "Dual",
all(c(Anchoveta, Sardina, Jurel) >= 0.25 & c(Anchoveta, Sardina, Jurel) <= 0.4) ~ "Balanced (30/30/30)",
TRUE ~ "Other"
)
) %>%
ungroup()
vessel_strategies_yearly <- vessel_species_year %>%
rowwise() %>%
mutate(
max_share = max(c(Anchoveta, Sardine, JackMackerel)),
top_two = sort(c(Anchoveta, Sardine, JackMackerel), decreasing = TRUE)[1:2],
strategy = case_when(
max_share >= 0.8 ~ "Specialist",
top_two[1] >= 0.4 & top_two[2] >= 0.4 ~ "Dual",
all(c(Anchoveta, Sardine, JackMackerel) >= 0.25 & c(Anchoveta, Sardina, Jurel) <= 0.4) ~ "Balanced (30/30/30)",
TRUE ~ "Other"
)
) %>%
ungroup()
vessel_strategies_yearly <- vessel_species_year %>%
rowwise() %>%
mutate(
max_share = max(c(Anchoveta, Sardine, JackMackerel)))
View(vessel_strategies_yearly)
vessel_strategies_yearly <- vessel_species_year %>%
rowwise() %>%
mutate(
max_share = max(c(Anchoveta, Sardine, JackMackerel))    ,
top_two = sort(c(Anchoveta, Sardine, JackMackerel), decreasing = TRUE)[1:2])
vessel_strategies_yearly <- vessel_species_year %>%
rowwise() %>%
mutate(
max_share = max(c(Anchoveta, Sardine, JackMackerel))    ,
top_two =  list(sort(c(Anchoveta, Sardina, Jurel), decreasing = TRUE)[1:2]))
vessel_strategies_yearly <- vessel_species_year %>%
rowwise() %>%
mutate(
max_share = max(c(Anchoveta, Sardine, JackMackerel))    ,
top_two =  list(sort(c(Anchoveta, Sardine, JackMackerel), decreasing = TRUE)[1:2]))
View(vessel_strategies_yearly)
View(vessel_species_year)
View(vessel_strategies_yearly)
vessel_strategies_yearly <- vessel_species_year %>%
rowwise() %>%
mutate(
max_share = max(c(Anchoveta, Sardine, JackMackerel))    ,
top_two =  list(sort(c(Anchoveta, Sardine, JackMackerel), decreasing = TRUE)[1:2]),
strategy = case_when(
max_share >= 0.8 ~ "Specialist",
top_two[1] >= 0.4 & top_two[2] >= 0.4 ~ "Dual",
all(c(Anchoveta, Sardine, JackMackerel) >= 0.25 & c(Anchoveta, Sardina, Jurel) <= 0.4) ~ "Balanced (30/30/30)",
TRUE ~ "Other"
)
) %>%
ungroup()
View(vessel_strategies_yearly)
vessel_strategies_yearly <- vessel_species_year %>%
rowwise() %>%
mutate(
max_share = max(c(Anchoveta, Sardine, JackMackerel))    ,
top_two =  list(sort(c(Anchoveta, Sardine, JackMackerel), decreasing = TRUE)[1:2]),
strategy = case_when(
max_share >= 0.8 ~ "Specialist",
top_two[1] >= 0.4 & top_two[2] >= 0.4 ~ "Dual",
all(c(Anchoveta, Sardine, JackMackerel) >= 0.25 & c(Anchoveta, Sardine, JackMackerel) <= 0.4) ~ "Balanced (30/30/30)",
TRUE ~ "Other"
)
) %>%
ungroup()
View(vessel_strategies_yearly)
View(vessel_strategies_yearly)
vessel_strategies_yearly <- vessel_species_year %>%
rowwise() %>%
mutate(
max_share = max(c(Anchoveta, Sardine, JackMackerel))    ,
top_two =  list(sort(c(Anchoveta, Sardine, JackMackerel), decreasing = TRUE)[1:2]),
strategy = case_when(
max_share >= 0.8 ~ "Specialist",
top_two[1] >= 0.25 & top_two[2] >= 0.254 ~ "Dual",
all(c(Anchoveta, Sardine, JackMackerel) >= 0.25 & c(Anchoveta, Sardine, JackMackerel) <= 0.4) ~ "Balanced (30/30/30)",
TRUE ~ "Other"
)
) %>%
ungroup()
View(vessel_strategies_yearly)
vessel_strategies_yearly <- vessel_species_year %>%
rowwise() %>%
mutate(
max_share = max(c(Anchoveta, Sardine, JackMackerel))    ,
top_two =  list(sort(c(Anchoveta, Sardine, JackMackerel), decreasing = TRUE)[1:2]),
strategy = case_when(
max_share >= 0.9 ~ "Specialist",
top_two[1] >= 0.25 & top_two[2] >= 0.254 ~ "Dual",
all(c(Anchoveta, Sardine, JackMackerel) >= 0.25 & c(Anchoveta, Sardine, JackMackerel) <= 0.4) ~ "Balanced (30/30/30)",
TRUE ~ "Other"
)
) %>%
ungroup()
vessel_strategies_yearly <- vessel_species_year %>%
rowwise() %>%
mutate(
max_share = max(c(Anchoveta, Sardine, JackMackerel))    ,
top_two =  list(sort(c(Anchoveta, Sardine, JackMackerel), decreasing = TRUE)[1:2]),
strategy = case_when(
max_share >= 0.9 ~ "Specialist",
top_two[1] >= 0.25 & top_two[2] >= 0.25 ~ "Dual",
all(c(Anchoveta, Sardine, JackMackerel) >= 0.1 & c(Anchoveta, Sardine, JackMackerel) <= 0.25) ~ "Balanced (30/30/30)",
TRUE ~ "Other"
)
) %>%
ungroup()
vessel_strategies_yearly %>%
count(year, strategy) %>%
tidyr::pivot_wider(names_from = strategy, values_from = n, values_fill = 0)
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE), .groups = "drop") %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch)) %>%
ungroup() %>%
pivot_wider(names_from = specie, values_from = species_share, values_fill = 0)
View(vessel_species_year)
View(ind_harvest_SERNAPESCA_ART)
ind_harvest_SERNAPESCA_ART <-
read_excel(paste0(dirdata, "SERNAPESCA/AH010T0006857_sobre_desembarque_pelagicos_2012_2024.xlsx"),
sheet = "ART_2012_2024",
range = "A6:S36337") %>%
rename(specie = Especie,
year = Año,
region = `Región de Operación`,
vessel_id = `RPA Embarcación`) %>%
mutate(zone = case_when(
region %in% c(1,2,3,4,15) ~ "Norte",
region %in% c(5,6,7,8,9,10,14,16) ~ "Centro-Sur",
region %in% c(11,12) ~ "Extremo Sur",
TRUE ~ "No Especifica"
)) %>%
filter(zone == "Centro-Sur") %>%
filter(specie == "ANCHOVETA" | specie == "SARDINA COMUN", specie == "JUREL")
ind_harvest_SERNAPESCA_ART <-
read_excel(paste0(dirdata, "SERNAPESCA/AH010T0006857_sobre_desembarque_pelagicos_2012_2024.xlsx"),
sheet = "ART_2012_2024",
range = "A6:S36337") %>%
rename(specie = Especie,
year = Año,
region = `Región de Operación`,
vessel_id = `RPA Embarcación`) %>%
mutate(zone = case_when(
region %in% c(1,2,3,4,15) ~ "Norte",
region %in% c(5,6,7,8,9,10,14,16) ~ "Centro-Sur",
region %in% c(11,12) ~ "Extremo Sur",
TRUE ~ "No Especifica"
)) %>%
filter(zone == "Centro-Sur") %>%
filter(specie == "ANCHOVETA" | specie == "SARDINA COMUN" | specie == "JUREL")
View(biomass)
View(ind_harvest_SERNAPESCA_ART)
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE), .groups = "drop") %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch)) %>%
ungroup() %>%
pivot_wider(names_from = specie, values_from = species_share, values_fill = 0)
View(vessel_species_year)
ind_harvest_SERNAPESCA_ART <-
read_excel(paste0(dirdata, "SERNAPESCA/AH010T0006857_sobre_desembarque_pelagicos_2012_2024.xlsx"),
sheet = "ART_2012_2024",
range = "A6:S36337") %>%
rename(specie = Especie,
year = Año,
region = `Región de Operación`,
vessel_id = `RPA Embarcación`) %>%
mutate(zone = case_when(
region %in% c(1,2,3,4,15) ~ "Norte",
region %in% c(5,6,7,8,9,10,14,16) ~ "Centro-Sur",
region %in% c(11,12) ~ "Extremo Sur",
TRUE ~ "No Especifica"
)) %>%
filter(zone == "Centro-Sur") %>%
filter(specie == "ANCHOVETA" | specie == "SARDINA COMUN" | specie == "JUREL")
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE), .groups = "drop") %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch)) %>%
ungroup() %>%
pivot_wider(names_from = specie, values_from = species_share, values_fill = 0)
View(ind_harvest_SERNAPESCA_ART)
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE), .groups = "drop") %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch)) %>%
ungroup()
View(vessel_species_year)
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE), .groups = "drop") %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch)) %>%
ungroup() %>%
pivot_wider(names_from = specie, values_from = species_share, values_fill = 0)
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE), .groups = "drop") %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch)) %>%
ungroup() %>%
pivot_wider(names_from = specie, values_from = species_share, values_fill = 0)
View(vessel_species_year)
rm(list = ls())
gc()
library(readxl)
library(dplyr)
# Definir directorios según usuario
usuario <- Sys.info()[["user"]]
# computador <- Sys.info()[["nodename"]]  # Alternativamente puedes usar esto
if (usuario == "felip") {
dirdata <- "C:/Users/felip/OneDrive - Universidad de Concepción/FONDECYT Iniciacion/Data/"
} else if (usuario == "FACEA") {
dirdata <- "C:/Users/FACEA/OneDrive - Universidad de Concepción/FONDECYT Iniciacion/Data/"
} else {
stop("Usuario no reconocido. Defina el directorio correspondiente.")
}
rm(usuario)
library(dplyr)
library(stringr)
#Anchovy and sardine biomass
anch_sard_biomass <- read_excel(paste0(dirdata, "IFOP/3. ESTIMACIONES CRUCERO ACUSTICO.xlsx"), sheet = "SARDINA-ANCHOVETA")
anch_sard_biomass <- anch_sard_biomass[, c(1, 2, 3, 4)]
anch_sard_biomass <- anch_sard_biomass[-1, ]
colnames(anch_sard_biomass) <- c("year", "cruise", "sardine_biomass", "anchoveta_biomass")
anch_sard_biomass <- anch_sard_biomass %>%
filter(str_detect(cruise, "Reclas")) %>%  ## Summer survey!
dplyr::select(-c(cruise)) %>%
mutate(across(ends_with("biomass"), ~as.numeric(.)))
anch_sard_biomass$year <- as.numeric(anch_sard_biomass$year)
biomass <- anch_sard_biomass
rm(list = c("anch_sard_biomass"))
library(readxl)
library(dplyr)
library(tidyr)
ind_harvest_SERNAPESCA_ART <-
read_excel(paste0(dirdata, "SERNAPESCA/AH010T0006857_sobre_desembarque_pelagicos_2012_2024.xlsx"),
sheet = "ART_2012_2024",
range = "A6:S36337") %>%
rename(specie = Especie,
year = Año,
region = `Región de Operación`,
vessel_id = `RPA Embarcación`) %>%
mutate(zone = case_when(
region %in% c(1,2,3,4,15) ~ "Norte",
region %in% c(5,6,7,8,9,10,14,16) ~ "Centro-Sur",
region %in% c(11,12) ~ "Extremo Sur",
TRUE ~ "No Especifica"
)) %>%
filter(zone == "Centro-Sur") %>%
filter(specie == "ANCHOVETA" | specie == "SARDINA COMUN" | specie == "JUREL")
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE), .groups = "drop") %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch)) %>%
ungroup() %>%
pivot_wider(names_from = specie, values_from = species_share, values_fill = 0) %>%
rename(
Anchoveta = `ANCHOVETA`,
Sardine = `SARDINA COMUN`,
JackMackerel = `JUREL`
)
View(vessel_species_year)
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE), .groups = "drop")
View(vessel_species_year)
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE), .groups = "drop") %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch)) %>%
ungroup()
View(vessel_species_year)
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE), .groups = "drop") %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch)) %>%
ungroup() %>%
pivot_wider(names_from = specie, values_from = species_share, values_fill = 0)
View(vessel_species_year)
vessel_species_year %>%
count(vessel_id, year) %>%
filter(n > 1)
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE), .groups = "drop")
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE), .groups = "drop") %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch))
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE), .groups = "drop") %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch)) %>%
ungroup()
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE), .groups = "drop") %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch)) %>%
ungroup() %>%
pivot_wider(names_from = specie, values_from = species_share, values_fill = 0)
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE), .groups = "drop") %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch)) %>%
ungroup()
View(vessel_species_year)
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE), .groups = "drop") %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch, na.rm = TRUE)) %>%
ungroup() %>%
pivot_wider(
names_from = specie,
values_from = species_share,
values_fill = 0
)
View(vessel_species_year)
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
select(vessel_id, year, specie, SumaDeDesembarque) %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE), .groups = "drop") %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch, na.rm = TRUE)) %>%
ungroup() %>%
pivot_wider(
names_from = specie,
values_from = species_share,
values_fill = 0
)
View(vessel_species_year)
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
select(vessel_id, year, specie, SumaDeDesembarque)
View(vessel_species_year)
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
select(vessel_id, year, specie, SumaDeDesembarque) %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE))
View(vessel_species_year)
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
select(vessel_id, year, specie, SumaDeDesembarque) %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE)) %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch, na.rm = TRUE)) %>%
ungroup()
View(vessel_species_year)
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
select(vessel_id, year, specie, SumaDeDesembarque) %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE)) %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch, na.rm = TRUE)) %>%
ungroup() %>%
select(-c(total_catch)) %>%
pivot_wider(
names_from = specie,
values_from = species_share,
values_fill = 0
)
View(vessel_species_year)
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
select(vessel_id, year, specie, SumaDeDesembarque) %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE)) %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch, na.rm = TRUE)) %>%
ungroup() %>%
select(-c(total_catch)) %>%
pivot_wider(
names_from = specie,
values_from = species_share,
values_fill = 0
) %>%
pivot_wider(names_from = specie, values_from = species_share, values_fill = 0)
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
select(vessel_id, year, specie, SumaDeDesembarque) %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE)) %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch, na.rm = TRUE)) %>%
ungroup() %>%
select(-c(total_catch)) %>%
pivot_wider(
names_from = specie,
values_from = species_share,
values_fill = 0
) %>%
pivot_wider(names_from = specie, values_from = species_share, values_fill = 0) %>%
rename(
Anchoveta = `ANCHOVETA`,
Sardine = `SARDINA COMUN`,
JackMackerel = `JUREL`
)
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
select(vessel_id, year, specie, SumaDeDesembarque) %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE)) %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch, na.rm = TRUE)) %>%
ungroup() %>%
select(-c(total_catch))
View(vessel_species_year)
vessel_species_year <- ind_harvest_SERNAPESCA_ART %>%
select(vessel_id, year, specie, SumaDeDesembarque) %>%
group_by(vessel_id, year, specie) %>%
summarize(total_catch = sum(SumaDeDesembarque, na.rm = TRUE)) %>%
group_by(vessel_id, year) %>%
mutate(species_share = total_catch / sum(total_catch, na.rm = TRUE)) %>%
ungroup() %>%
select(-c(total_catch)) %>%
pivot_wider(
names_from = specie,
values_from = species_share,
values_fill = 0
) %>%
rename(
Anchoveta = `ANCHOVETA`,
Sardine = `SARDINA COMUN`,
JackMackerel = `JUREL`
)
View(vessel_species_year)
vessel_strategies_yearly <- vessel_species_year %>%
rowwise() %>%
mutate(
max_share = max(c(Anchoveta, Sardine, JackMackerel))    ,
top_two =  list(sort(c(Anchoveta, Sardine, JackMackerel), decreasing = TRUE)[1:2]),
strategy = case_when(
max_share >= 0.9 ~ "Specialist",
top_two[1] >= 0.25 & top_two[2] >= 0.25 ~ "Dual",
all(c(Anchoveta, Sardine, JackMackerel) >= 0.1 & c(Anchoveta, Sardine, JackMackerel) <= 0.25) ~ "Balanced (30/30/30)",
TRUE ~ "Other"
)
) %>%
ungroup()
View(vessel_strategies_yearly)
vessel_strategies_yearly %>%
count(year, strategy) %>%
tidyr::pivot_wider(names_from = strategy, values_from = n, values_fill = 0)
