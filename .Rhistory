pivot_wider(
names_from = NOMBRE_ESPECIE,
values_from = species_share,
values_fill = 0
)
# %>%
#   dplyr::select(c(COD_BARCO, ANCHOVETA, `SARDINA COMUN`, JUREL)) %>%
#   mutate(OTHER = 1 - ANCHOVETA - `SARDINA COMUN` - JUREL) %>%
#   rename(
#     Anchoveta = `ANCHOVETA`,
#     Sardine = `SARDINA COMUN`,
#     JackMackerel = `JUREL`,
#     Other = `OTHER`
#   )
get_strategy_general <- function(row, threshold = 0.20) {
# row = one vessel with species shares
species <- names(row)[row > threshold]
if (length(species) == 0) return("None or negligible")
if (length(species) == 1) return(paste("Only", species))
if (length(species) == 2) return(paste(species, collapse = " and "))
return(paste(paste(species[-length(species)], collapse = ", "), "and", species[length(species)]))
}
# Apply strategy classification
vessel_species_year <- vessel_species_year %>%
rowwise() %>%
mutate(strategy_After = get_strategy_general(c_across(-c(COD_BARCO, TIPO_FLOTA)))) %>%
ungroup()
# Compute percentages by fleet type
strategy_percent <- vessel_species_year %>%
group_by(TIPO_FLOTA, strategy_After) %>%
summarise(n = n(), .groups = "drop") %>%
group_by(TIPO_FLOTA) %>%
mutate(percent = round(100 * n / sum(n), 1)) %>%
arrange(TIPO_FLOTA, desc(percent))
# Final table of strategies by vessel
strategy_after <- vessel_species_year %>%
select(COD_BARCO, TIPO_FLOTA, strategy_After)
View(strategy_after)
View(strategy_percent)
View(vessel_species_year)
vessel_species_year <- logbooks %>%
filter(year >= 2019) %>%
select(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE, CAPTURA_RETENIDA) %>%
group_by(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE) %>%
summarise(total_catch = sum(CAPTURA_RETENIDA, na.rm = TRUE), .groups = "drop") %>%
group_by(COD_BARCO, TIPO_FLOTA, year) %>%
mutate(species_share = total_catch / sum(total_catch, na.rm = TRUE)) %>%
ungroup() %>%
select(-total_catch) %>%
complete(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE, fill = list(species_share = 0)) %>%
group_by(COD_BARCO, TIPO_FLOTA, year) %>%
mutate(species_share_check = sum(species_share, na.rm = TRUE)) %>%
filter(species_share_check > 0) %>%
select(-species_share_check) %>%
group_by(COD_BARCO, TIPO_FLOTA, NOMBRE_ESPECIE) %>%
summarise(species_share = mean(species_share, na.rm = TRUE), .groups = "drop") %>%
pivot_wider(
names_from = NOMBRE_ESPECIE,
values_from = species_share,
values_fill = 0
)
# %>%
#   dplyr::select(c(COD_BARCO, ANCHOVETA, `SARDINA COMUN`, JUREL)) %>%
#   mutate(OTHER = 1 - ANCHOVETA - `SARDINA COMUN` - JUREL) %>%
#   rename(
#     Anchoveta = `ANCHOVETA`,
#     Sardine = `SARDINA COMUN`,
#     JackMackerel = `JUREL`,
#     Other = `OTHER`
#   )
get_strategy_general <- function(row, threshold = 0.20) {
# row = one vessel with species shares
species <- names(row)[row > threshold]
if (length(species) == 0) return("None or negligible")
if (length(species) == 1) return(paste("Only", species))
if (length(species) == 2) return(paste(species, collapse = " and "))
return(paste(paste(species[-length(species)], collapse = ", "), "and", species[length(species)]))
}
# Apply strategy classification
vessel_species_year <- vessel_species_year %>%
rowwise() %>%
mutate(strategy_After = get_strategy_general(c_across(-c(COD_BARCO, TIPO_FLOTA)))) %>%
ungroup()
View(vessel_species_year)
vessel_species_year <- logbooks %>%
filter(year >= 2019) %>%
select(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE, CAPTURA_RETENIDA) %>%
# catch per vessel-year-species
group_by(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE) %>%
summarise(total_catch = sum(CAPTURA_RETENIDA, na.rm = TRUE), .groups = "drop") %>%
# share within vessel-year
group_by(COD_BARCO, TIPO_FLOTA, year) %>%
mutate(species_share = ifelse(sum(total_catch, na.rm = TRUE) == 0, 0,
total_catch / sum(total_catch, na.rm = TRUE))) %>%
ungroup() %>%
select(-total_catch) %>%
# average across years for each (vessel, fleet, species)
group_by(COD_BARCO, TIPO_FLOTA, NOMBRE_ESPECIE) %>%
summarise(species_share = mean(species_share, na.rm = TRUE), .groups = "drop") %>%
# wide: one column per species (zeros where missing)
pivot_wider(names_from = NOMBRE_ESPECIE, values_from = species_share, values_fill = 0) %>%
arrange(COD_BARCO)
# 2) Which columns are species?
species_cols <- setdiff(names(vessel_species_year), c("COD_BARCO", "TIPO_FLOTA"))
species_max <- vessel_species_year %>%
summarise(across(all_of(species_cols), ~max(.x, na.rm = TRUE))) %>%
pivot_longer(everything(), names_to = "species", values_to = "max_share") %>%
arrange(desc(max_share))
View(species_max)
print(head(species_max, 30))   # show top species maxima (inspect this output)
threshold <- 0.20
vessel_species_year <- vessel_species_year %>%
mutate(strategy_After = pmap_chr(
select(., all_of(species_cols)),
function(...) {
vals <- c(...)
names(vals) <- species_cols
sel <- names(vals)[(!is.na(vals)) & vals > threshold]
if (length(sel) == 0) return("None or negligible")
if (length(sel) == 1) return(paste("Only", sel))
if (length(sel) == 2) return(paste(sel, collapse = " and "))
paste(paste(sel[-length(sel)], collapse = ", "), "and", sel[length(sel)])
}
))
View(vessel_species_year)
strategy_percent <- vessel_species_year %>%
group_by(TIPO_FLOTA, strategy_After) %>%
summarise(n = n(), .groups = "drop") %>%
group_by(TIPO_FLOTA) %>%
mutate(percent = round(100 * n / sum(n), 1)) %>%
arrange(TIPO_FLOTA, desc(percent))
View(strategy_percent)
# Build shares per vessel/fleet/year/species
vessel_species_year <- logbooks %>%
filter(year >= 2019) %>%
select(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE, CAPTURA_RETENIDA) %>%
group_by(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE) %>%
summarise(total_catch = sum(CAPTURA_RETENIDA, na.rm = TRUE), .groups = "drop") %>%
group_by(COD_BARCO, TIPO_FLOTA, year) %>%
mutate(species_share = total_catch / sum(total_catch, na.rm = TRUE)) %>%
ungroup() %>%
select(-total_catch) %>%
complete(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE, fill = list(species_share = 0)) %>%
group_by(COD_BARCO, TIPO_FLOTA, year) %>%
mutate(species_share_check = sum(species_share, na.rm = TRUE)) %>%
filter(species_share_check > 0) %>%
select(-species_share_check) %>%
group_by(COD_BARCO, TIPO_FLOTA, NOMBRE_ESPECIE) %>%
summarise(species_share = mean(species_share, na.rm = TRUE), .groups = "drop") %>%
pivot_wider(
names_from = NOMBRE_ESPECIE,
values_from = species_share,
values_fill = 0
) %>%
# keep focal species + aggregate "Other"
mutate(
ANCHOVETA = ifelse(!"ANCHOVETA" %in% names(.), 0, ANCHOVETA),
`SARDINA COMUN` = ifelse(!"SARDINA COMUN" %in% names(.), 0, `SARDINA COMUN`),
JUREL = ifelse(!"JUREL" %in% names(.), 0, JUREL)
) %>%
mutate(
OTHER = 1 - ANCHOVETA - `SARDINA COMUN` - JUREL,
Anchoveta = ANCHOVETA,
Sardine = `SARDINA COMUN`,
JackMackerel = JUREL,
Other = OTHER
) %>%
select(COD_BARCO, TIPO_FLOTA, Anchoveta, Sardine, JackMackerel, Other)
View(vessel_species_year)
# Strategy function
get_strategy <- function(sardine, jackmackerel, anchoveta, other) {
species <- c()
if (sardine > 0.20) species <- c(species, "Sardine")
if (jackmackerel > 0.20) species <- c(species, "JackMackerel")
if (anchoveta > 0.20) species <- c(species, "Anchoveta")
if (other > 0.20) species <- c(species, "Other")
n <- length(species)
if (n == 0) return("None or negligible")
if (n == 1) return(paste("Only", species[1]))
if (n == 2) return(paste(species[1], "and", species[2]))
if (n == 3) return(paste(species[1], ",", species[2], "and", species[3]))
return(paste(species, collapse = ", "))
}
# Apply strategy classification
vessel_species_year <- vessel_species_year %>%
mutate(strategy_After = pmap_chr(
list(Sardine, JackMackerel, Anchoveta, Other),
get_strategy
))
View(vessel_species_year)
strategy_percent <- vessel_species_year %>%
group_by(TIPO_FLOTA, strategy_After) %>%
summarise(n = n(), .groups = "drop") %>%
group_by(TIPO_FLOTA) %>%
mutate(percent = round(100 * n / sum(n), 1)) %>%
arrange(TIPO_FLOTA, desc(percent))
View(strategy_percent)
# Final table vessel-strategy
strategy_after <- vessel_species_year %>%
select(COD_BARCO, TIPO_FLOTA, strategy_After)
View(strategy_after)
vessel_species_year <- logbooks %>%
filter(year >= 2019) %>%
select(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE, CAPTURA_RETENIDA) %>%
group_by(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE) %>%
summarise(total_catch = sum(CAPTURA_RETENIDA, na.rm = TRUE), .groups = "drop") %>%
group_by(COD_BARCO, TIPO_FLOTA, year) %>%
mutate(species_share = total_catch / sum(total_catch, na.rm = TRUE)) %>%
ungroup() %>%
select(-total_catch) %>%
complete(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE, fill = list(species_share = 0)) %>%
group_by(COD_BARCO, TIPO_FLOTA, year) %>%
mutate(species_share_check = sum(species_share, na.rm = TRUE)) %>%
filter(species_share_check > 0) %>%
select(-species_share_check) %>%
group_by(COD_BARCO, TIPO_FLOTA, NOMBRE_ESPECIE) %>%
summarise(species_share = mean(species_share, na.rm = TRUE), .groups = "drop") %>%
pivot_wider(
names_from = NOMBRE_ESPECIE,
values_from = species_share,
values_fill = 0
) %>%
# keep focal species + aggregate "Other"
mutate(
ANCHOVETA = ifelse(!"ANCHOVETA" %in% names(.), 0, ANCHOVETA),
`SARDINA COMUN` = ifelse(!"SARDINA COMUN" %in% names(.), 0, `SARDINA COMUN`),
JUREL = ifelse(!"JUREL" %in% names(.), 0, JUREL)
) %>%
mutate(
OTHER = 1 - ANCHOVETA - `SARDINA COMUN` - JUREL,
Anchoveta = ANCHOVETA,
Sardine = `SARDINA COMUN`,
JackMackerel = JUREL,
Other = OTHER
) %>%
select(COD_BARCO, TIPO_FLOTA, Anchoveta, Sardine, JackMackerel, Other)
# Strategy function
get_strategy <- function(sardine, jackmackerel, anchoveta, other) {
species <- c()
if (sardine > 0.15) species <- c(species, "Sardine")
if (jackmackerel > 0.15) species <- c(species, "JackMackerel")
if (anchoveta > 0.15) species <- c(species, "Anchoveta")
if (other > 0.15) species <- c(species, "Other")
n <- length(species)
if (n == 0) return("None or negligible")
if (n == 1) return(paste("Only", species[1]))
if (n == 2) return(paste(species[1], "and", species[2]))
if (n == 3) return(paste(species[1], ",", species[2], "and", species[3]))
return(paste(species, collapse = ", "))
}
# Apply strategy classification
vessel_species_year <- vessel_species_year %>%
mutate(strategy_After = pmap_chr(
list(Sardine, JackMackerel, Anchoveta, Other),
get_strategy
))
# Percentages by fleet type
strategy_percent <- vessel_species_year %>%
group_by(TIPO_FLOTA, strategy_After) %>%
summarise(n = n(), .groups = "drop") %>%
group_by(TIPO_FLOTA) %>%
mutate(percent = round(100 * n / sum(n), 1)) %>%
arrange(TIPO_FLOTA, desc(percent))
# Final table vessel-strategy
strategy_after <- vessel_species_year %>%
select(COD_BARCO, TIPO_FLOTA, strategy_After)
View(vessel_species_year)
vessel_species_year <- logbooks %>%
filter(year >= 2019) %>%
select(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE, CAPTURA_RETENIDA) %>%
group_by(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE) %>%
summarise(total_catch = sum(CAPTURA_RETENIDA, na.rm = TRUE), .groups = "drop") %>%
group_by(COD_BARCO, TIPO_FLOTA, year) %>%
mutate(species_share = total_catch / sum(total_catch, na.rm = TRUE)) %>%
ungroup() %>%
select(-total_catch) %>%
complete(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE, fill = list(species_share = 0)) %>%
group_by(COD_BARCO, TIPO_FLOTA, year) %>%
mutate(species_share_check = sum(species_share, na.rm = TRUE)) %>%
filter(species_share_check > 0) %>%
select(-species_share_check) %>%
group_by(COD_BARCO, TIPO_FLOTA, NOMBRE_ESPECIE) %>%
summarise(species_share = mean(species_share, na.rm = TRUE), .groups = "drop") %>%
pivot_wider(
names_from = NOMBRE_ESPECIE,
values_from = species_share,
values_fill = 0
)
View(vessel_species_year)
vessel_species_year <- logbooks %>%
filter(year >= 2019) %>%
select(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE, CAPTURA_RETENIDA) %>%
group_by(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE) %>%
summarise(total_catch = sum(CAPTURA_RETENIDA, na.rm = TRUE), .groups = "drop") %>%
group_by(COD_BARCO, TIPO_FLOTA, year) %>%
mutate(species_share = total_catch / sum(total_catch, na.rm = TRUE)) %>%
ungroup() %>%
select(-total_catch) %>%
complete(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE, fill = list(species_share = 0)) %>%
group_by(COD_BARCO, TIPO_FLOTA, year) %>%
mutate(species_share_check = sum(species_share, na.rm = TRUE)) %>%
filter(species_share_check > 0) %>%
select(-species_share_check) %>%
group_by(COD_BARCO, TIPO_FLOTA, NOMBRE_ESPECIE) %>%
summarise(species_share = mean(species_share, na.rm = TRUE), .groups = "drop") %>%
pivot_wider(
names_from = NOMBRE_ESPECIE,
values_from = species_share,
values_fill = 0
) %>%
mutate(
ANCHOVETA = ifelse(!"ANCHOVETA" %in% names(.), 0, ANCHOVETA),
`SARDINA COMUN` = ifelse(!"SARDINA COMUN" %in% names(.), 0, `SARDINA COMUN`),
JUREL = ifelse(!"JUREL" %in% names(.), 0, JUREL)
)
View(vessel_species_year)
vessel_species_year <- logbooks %>%
filter(year >= 2019) %>%
select(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE, CAPTURA_RETENIDA) %>%
group_by(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE) %>%
summarise(total_catch = sum(CAPTURA_RETENIDA, na.rm = TRUE), .groups = "drop") %>%
group_by(COD_BARCO, TIPO_FLOTA, year) %>%
mutate(species_share = total_catch / sum(total_catch, na.rm = TRUE)) %>%
ungroup() %>%
select(-total_catch) %>%
complete(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE, fill = list(species_share = 0)) %>%
group_by(COD_BARCO, TIPO_FLOTA, year) %>%
filter(sum(species_share, na.rm = TRUE) > 0) %>%
group_by(COD_BARCO, TIPO_FLOTA, NOMBRE_ESPECIE) %>%
summarise(species_share = mean(species_share, na.rm = TRUE), .groups = "drop") %>%
pivot_wider(
names_from = NOMBRE_ESPECIE,
values_from = species_share,
values_fill = 0
) %>%
# here just add missing columns if they don't exist
{ if(!"ANCHOVETA" %in% names(.)) .$ANCHOVETA <- 0; . } %>%
{ if(!"SARDINA COMUN" %in% names(.)) .$`SARDINA COMUN` <- 0; . } %>%
{ if(!"JUREL" %in% names(.)) .$JUREL <- 0; . } %>%
mutate(
Other = 1 - ANCHOVETA - `SARDINA COMUN` - JUREL,
Anchoveta = ANCHOVETA,
Sardine = `SARDINA COMUN`,
JackMackerel = JUREL
) %>%
select(COD_BARCO, TIPO_FLOTA, Anchoveta, Sardine, JackMackerel, Other)
View(vessel_species_year)
get_strategy <- function(sardine, jackmackerel, anchoveta, other) {
species <- c()
if (sardine > 0.15) species <- c(species, "Sardine")
if (jackmackerel > 0.15) species <- c(species, "JackMackerel")
if (anchoveta > 0.15) species <- c(species, "Anchoveta")
if (other > 0.15) species <- c(species, "Other")
get_strategy <- function(sardine, jackmackerel, anchoveta, other) {
species <- c()
if (sardine > 0.15) species <- c(species, "Sardine")
if (jackmackerel > 0.15) species <- c(species, "JackMackerel")
if (anchoveta > 0.15) species <- c(species, "Anchoveta")
if (other > 0.15) species <- c(species, "Other")
n <- length(species)
if (n == 0) return("None or negligible")
if (n == 1) return(paste("Only", species[1]))
if (n == 2) return(paste(species[1], "and", species[2]))
if (n == 3) return(paste(species[1], ",", species[2], "and", species[3]))
return(paste(species, collapse = ", "))
}
# Apply strategy classification
vessel_species_year <- vessel_species_year %>%
mutate(strategy_After = pmap_chr(
list(Sardine, JackMackerel, Anchoveta, Other),
get_strategy
))
# Percentages by fleet type
strategy_percent <- vessel_species_year %>%
group_by(TIPO_FLOTA, strategy_After) %>%
summarise(n = n(), .groups = "drop") %>%
group_by(TIPO_FLOTA) %>%
mutate(percent = round(100 * n / sum(n), 1)) %>%
arrange(TIPO_FLOTA, desc(percent))
# Final table vessel-strategy
strategy_after <- vessel_species_year %>%
select(COD_BARCO, TIPO_FLOTA, strategy_After)
View(strategy_after)
View(strategy_after)
View(strategy_percent)
View(strategy_percent)
View(strategy_percent)
# Apply strategy classification
vessel_species_year <- vessel_species_year %>%
mutate(strategy_After = pmap_chr(
list(Sardine, JackMackerel, Anchoveta, Other),
get_strategy
))
View(vessel_species_year)
vessel_species_year <- logbooks %>%
filter(year >= 2019) %>%
select(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE, CAPTURA_RETENIDA) %>%
group_by(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE) %>%
summarise(total_catch = sum(CAPTURA_RETENIDA, na.rm = TRUE), .groups = "drop") %>%
group_by(COD_BARCO, TIPO_FLOTA, year) %>%
mutate(species_share = total_catch / sum(total_catch, na.rm = TRUE)) %>%
ungroup() %>%
select(-total_catch) %>%
complete(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE, fill = list(species_share = 0)) %>%
group_by(COD_BARCO, TIPO_FLOTA, year) %>%
filter(sum(species_share, na.rm = TRUE) > 0) %>%
group_by(COD_BARCO, TIPO_FLOTA, NOMBRE_ESPECIE) %>%
summarise(species_share = mean(species_share, na.rm = TRUE), .groups = "drop") %>%
pivot_wider(
names_from = NOMBRE_ESPECIE,
values_from = species_share,
values_fill = 0
) %>%
# here just add missing columns if they don't exist
{ if(!"ANCHOVETA" %in% names(.)) .$ANCHOVETA <- 0; . } %>%
{ if(!"SARDINA COMUN" %in% names(.)) .$`SARDINA COMUN` <- 0; . } %>%
{ if(!"JUREL" %in% names(.)) .$JUREL <- 0; . } %>%
mutate(
Other = 1 - ANCHOVETA - `SARDINA COMUN` - JUREL,
Anchoveta = ANCHOVETA,
Sardine = `SARDINA COMUN`,
JackMackerel = JUREL
) %>%
select(COD_BARCO, TIPO_FLOTA, Anchoveta, Sardine, JackMackerel, Other)
# Strategy function
get_strategy <- function(sardine, jackmackerel, anchoveta, other) {
species <- c()
if (sardine > 0.15) species <- c(species, "Sardine")
if (jackmackerel > 0.15) species <- c(species, "JackMackerel")
if (anchoveta > 0.15) species <- c(species, "Anchoveta")
if (other > 0.15) species <- c(species, "Other")
n <- length(species)
if (n == 0) return("None or negligible")
if (n == 1) return(paste("Only", species[1]))
if (n == 2) return(paste(species[1], "and", species[2]))
if (n == 3) return(paste(species[1], ",", species[2], "and", species[3]))
return(paste(species, collapse = ", "))
}
# Apply strategy classification
vessel_species_year <- vessel_species_year %>%
mutate(strategy_After = pmap_chr(
list(Sardine, JackMackerel, Anchoveta, Other),
get_strategy
))
# Percentages by fleet type
strategy_percent <- vessel_species_year %>%
group_by(TIPO_FLOTA, strategy_After) %>%
summarise(n = n(), .groups = "drop") %>%
group_by(TIPO_FLOTA) %>%
mutate(percent = round(100 * n / sum(n), 1)) %>%
arrange(TIPO_FLOTA, desc(percent))
View(strategy_percent)
# Final table vessel-strategy
strategy_after <- vessel_species_year %>%
select(COD_BARCO, TIPO_FLOTA, strategy_After)
# Build shares per vessel/fleet/year/species
vessel_species_year <- logbooks %>%
filter(year < 2019) %>%
select(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE, CAPTURA_RETENIDA) %>%
group_by(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE) %>%
summarise(total_catch = sum(CAPTURA_RETENIDA, na.rm = TRUE), .groups = "drop") %>%
group_by(COD_BARCO, TIPO_FLOTA, year) %>%
mutate(species_share = total_catch / sum(total_catch, na.rm = TRUE)) %>%
ungroup() %>%
select(-total_catch) %>%
complete(COD_BARCO, TIPO_FLOTA, year, NOMBRE_ESPECIE, fill = list(species_share = 0)) %>%
group_by(COD_BARCO, TIPO_FLOTA, year) %>%
filter(sum(species_share, na.rm = TRUE) > 0) %>%
group_by(COD_BARCO, TIPO_FLOTA, NOMBRE_ESPECIE) %>%
summarise(species_share = mean(species_share, na.rm = TRUE), .groups = "drop") %>%
pivot_wider(
names_from = NOMBRE_ESPECIE,
values_from = species_share,
values_fill = 0
) %>%
# here just add missing columns if they don't exist
{ if(!"ANCHOVETA" %in% names(.)) .$ANCHOVETA <- 0; . } %>%
{ if(!"SARDINA COMUN" %in% names(.)) .$`SARDINA COMUN` <- 0; . } %>%
{ if(!"JUREL" %in% names(.)) .$JUREL <- 0; . } %>%
mutate(
Other = 1 - ANCHOVETA - `SARDINA COMUN` - JUREL,
Anchoveta = ANCHOVETA,
Sardine = `SARDINA COMUN`,
JackMackerel = JUREL
) %>%
select(COD_BARCO, TIPO_FLOTA, Anchoveta, Sardine, JackMackerel, Other)
# Apply strategy classification
vessel_species_year <- vessel_species_year %>%
mutate(strategy_Before = pmap_chr(
list(Sardine, JackMackerel, Anchoveta, Other),
get_strategy
))
# Percentages by fleet type
strategy_percent_before <- vessel_species_year %>%
group_by(TIPO_FLOTA, strategy_After) %>%
summarise(n = n(), .groups = "drop") %>%
group_by(TIPO_FLOTA) %>%
mutate(percent = round(100 * n / sum(n), 1)) %>%
arrange(TIPO_FLOTA, desc(percent))
View(vessel_species_year)
# Percentages by fleet type
strategy_percent_before <- vessel_species_year %>%
group_by(TIPO_FLOTA, strategy_Before) %>%
summarise(n = n(), .groups = "drop") %>%
group_by(TIPO_FLOTA) %>%
mutate(percent = round(100 * n / sum(n), 1)) %>%
arrange(TIPO_FLOTA, desc(percent))
View(strategy_percent_before)
# Final table vessel-strategy
strategy_before <- vessel_species_year %>%
select(COD_BARCO, TIPO_FLOTA, strategy_Before)
View(strategy_before)
